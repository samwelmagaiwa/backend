{"type":"begin","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"}}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'has_signature' => !empty($userAccess->ict_officer_signature_path),\n"},"line_number":138,"absolute_offset":8638,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'status' => $userAccess->ict_officer_implemented_at ? 'implemented' : 'pending'\n"},"line_number":139,"absolute_offset":8730,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ]\n"},"line_number":140,"absolute_offset":8834,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ],\n"},"line_number":141,"absolute_offset":8856,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                \n"},"line_number":142,"absolute_offset":8875,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_info' => [\n"},"line_number":143,"absolute_offset":8892,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'pf_number' => $userAccess->pf_number,\n"},"line_number":144,"absolute_offset":8925,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'staff_name' => $userAccess->staff_name,\n"},"line_number":145,"absolute_offset":8984,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'department' => $userAccess->department?->name ?? 'N/A',\n"},"line_number":146,"absolute_offset":9045,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'phone_number' => $userAccess->phone_number\n"},"line_number":147,"absolute_offset":9122,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ]\n"},"line_number":148,"absolute_offset":9186,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ];\n"},"line_number":149,"absolute_offset":9204,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":150,"absolute_offset":9219,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::info('Module request data retrieved', [\n"},"line_number":151,"absolute_offset":9232,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'request_id' => $userAccess->id,\n"},"line_number":152,"absolute_offset":9289,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'accessed_by' => $currentUser->id,\n"},"line_number":153,"absolute_offset":9338,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'module_requested_for' => $moduleData['module_requested_for'],\n"},"line_number":154,"absolute_offset":9389,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'wellsoft_count' => $moduleData['wellsoft_modules']['count'],\n"},"line_number":155,"absolute_offset":9468,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'jeeva_count' => $moduleData['jeeva_modules']['count']\n"},"line_number":156,"absolute_offset":9546,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":157,"absolute_offset":9617,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":158,"absolute_offset":9633,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":159,"absolute_offset":9646,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":160,"absolute_offset":9684,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $moduleData\n"},"line_number":161,"absolute_offset":9719,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":162,"absolute_offset":9757,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":163,"absolute_offset":9773,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":164,"absolute_offset":9786,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error getting module request data', [\n"},"line_number":165,"absolute_offset":9820,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":166,"absolute_offset":9882,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_access_id' => $userAccessId,\n"},"line_number":167,"absolute_offset":9927,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'current_user_id' => $request->user()?->id\n"},"line_number":168,"absolute_offset":9978,"submatches":[{"match":{"text":"user_id' ="},"start":25,"end":35}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":169,"absolute_offset":10037,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":170,"absolute_offset":10053,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":171,"absolute_offset":10066,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":172,"absolute_offset":10104,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to get module request data'\n"},"line_number":173,"absolute_offset":10140,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":174,"absolute_offset":10205,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":175,"absolute_offset":10226,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    }\n"},"line_number":176,"absolute_offset":10236,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":177,"absolute_offset":10242,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    /**\n"},"line_number":178,"absolute_offset":10243,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     * Get all pending module requests for HOD dashboard\n"},"line_number":179,"absolute_offset":10251,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":180,"absolute_offset":10308,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function getPendingModuleRequests(Request $request): JsonResponse\n"},"line_number":181,"absolute_offset":10316,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":182,"absolute_offset":10393,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":183,"absolute_offset":10399,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $currentUser = $request->user();\n"},"line_number":184,"absolute_offset":10413,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userRoles = $currentUser->roles()->pluck('name')->toArray();\n"},"line_number":185,"absolute_offset":10458,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":186,"absolute_offset":10532,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Build query based on user role\n"},"line_number":187,"absolute_offset":10545,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $query = UserAccess::with(['user', 'department'])\n"},"line_number":188,"absolute_offset":10591,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->whereIn('status', ['pending', 'hod_pending'])\n"},"line_number":189,"absolute_offset":10653,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->orderBy('created_at', 'desc');\n"},"line_number":190,"absolute_offset":10717,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":191,"absolute_offset":10766,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Filter by department for HOD\n"},"line_number":192,"absolute_offset":10779,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (array_intersect($userRoles, ['head_of_department'])) {\n"},"line_number":193,"absolute_offset":10823,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $hodDepartment = Department::where('hod_user_id', $currentUser->id)->first();\n"},"line_number":194,"absolute_offset":10894,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                if (!$hodDepartment) {\n"},"line_number":195,"absolute_offset":10988,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    return response()->json([\n"},"line_number":196,"absolute_offset":11027,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'success' => false,\n"},"line_number":197,"absolute_offset":11073,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'message' => 'Department not found for HOD user.'\n"},"line_number":198,"absolute_offset":11117,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'ict_director_name' => $userAccess->ict_director_name,\n"},"line_number":257,"absolute_offset":15153,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'ict_director_approved_at' => $userAccess->ict_director_approved_at,\n"},"line_number":258,"absolute_offset":15232,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'ict_director_approved_at_formatted' => $userAccess->ict_director_approved_at ? $userAccess->ict_director_approved_at->format('m/d/Y') : null,\n"},"line_number":259,"absolute_offset":15325,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'has_ict_director_signature' => !empty($userAccess->ict_director_signature_path),\n"},"line_number":260,"absolute_offset":15492,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'has_ict_director_approval' => !empty($userAccess->ict_director_approved_at),\n"},"line_number":261,"absolute_offset":15598,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'next_approval_needed' => $userAccess->getNextApprovalNeeded()\n"},"line_number":262,"absolute_offset":15700,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ]\n"},"line_number":263,"absolute_offset":15787,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ];\n"},"line_number":264,"absolute_offset":15809,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            });\n"},"line_number":265,"absolute_offset":15828,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":266,"absolute_offset":15844,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Filter to only show requests with module data if specifically requested\n"},"line_number":267,"absolute_offset":15857,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if ($request->get('modules_only') === 'true') {\n"},"line_number":268,"absolute_offset":15944,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $requests = $requests->filter(function ($request) {\n"},"line_number":269,"absolute_offset":16004,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    return $request['has_module_request'];\n"},"line_number":270,"absolute_offset":16072,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                });\n"},"line_number":271,"absolute_offset":16131,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":272,"absolute_offset":16151,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":273,"absolute_offset":16165,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":274,"absolute_offset":16178,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":275,"absolute_offset":16216,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $requests->values(),\n"},"line_number":276,"absolute_offset":16251,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'total' => $requests->count(),\n"},"line_number":277,"absolute_offset":16298,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'filters_applied' => [\n"},"line_number":278,"absolute_offset":16345,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'status' => ['pending', 'hod_pending'],\n"},"line_number":279,"absolute_offset":16384,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'modules_only' => $request->get('modules_only') === 'true'\n"},"line_number":280,"absolute_offset":16444,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ]\n"},"line_number":281,"absolute_offset":16523,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":282,"absolute_offset":16541,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":283,"absolute_offset":16557,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":284,"absolute_offset":16570,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error getting pending module requests', [\n"},"line_number":285,"absolute_offset":16604,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":286,"absolute_offset":16670,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'current_user_id' => $request->user()?->id\n"},"line_number":287,"absolute_offset":16715,"submatches":[{"match":{"text":"user_id' ="},"start":25,"end":35}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":288,"absolute_offset":16774,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":289,"absolute_offset":16790,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":290,"absolute_offset":16803,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":291,"absolute_offset":16841,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to get pending module requests'\n"},"line_number":292,"absolute_offset":16877,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":293,"absolute_offset":16946,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":294,"absolute_offset":16967,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    }\n"},"line_number":295,"absolute_offset":16977,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":296,"absolute_offset":16983,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    /**\n"},"line_number":297,"absolute_offset":16984,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     * Get module request statistics for dashboard\n"},"line_number":298,"absolute_offset":16992,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":299,"absolute_offset":17043,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function getModuleRequestStatistics(Request $request): JsonResponse\n"},"line_number":300,"absolute_offset":17051,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":301,"absolute_offset":17130,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":302,"absolute_offset":17136,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $currentUser = $request->user();\n"},"line_number":303,"absolute_offset":17150,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userRoles = $currentUser->roles()->pluck('name')->toArray();\n"},"line_number":304,"absolute_offset":17195,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":305,"absolute_offset":17269,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Build query based on user role\n"},"line_number":306,"absolute_offset":17282,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $query = UserAccess::with(['department']);\n"},"line_number":307,"absolute_offset":17328,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":308,"absolute_offset":17383,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Filter by department for HOD\n"},"line_number":309,"absolute_offset":17396,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (array_intersect($userRoles, ['head_of_department'])) {\n"},"line_number":310,"absolute_offset":17440,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $hodDepartment = Department::where('hod_user_id', $currentUser->id)->first();\n"},"line_number":311,"absolute_offset":17511,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                if (!$hodDepartment) {\n"},"line_number":312,"absolute_offset":17605,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    return response()->json([\n"},"line_number":313,"absolute_offset":17644,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'success' => false,\n"},"line_number":314,"absolute_offset":17690,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'message' => 'Department not found for HOD user.'\n"},"line_number":315,"absolute_offset":17734,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ], 404);\n"},"line_number":316,"absolute_offset":17808,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                }\n"},"line_number":317,"absolute_offset":17837,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        return count($req->jeeva_modules ?? []);\n"},"line_number":357,"absolute_offset":20169,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    })->sum()\n"},"line_number":358,"absolute_offset":20234,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ],\n"},"line_number":359,"absolute_offset":20264,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'by_status' => [\n"},"line_number":360,"absolute_offset":20283,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'pending' => $allRequests->where('status', 'pending')->count(),\n"},"line_number":361,"absolute_offset":20316,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'hod_pending' => $allRequests->where('status', 'hod_pending')->count(),\n"},"line_number":362,"absolute_offset":20400,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approved' => $allRequests->where('status', 'approved')->count(),\n"},"line_number":363,"absolute_offset":20492,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'rejected' => $allRequests->where('status', 'rejected')->count()\n"},"line_number":364,"absolute_offset":20578,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ],\n"},"line_number":365,"absolute_offset":20663,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'recent_requests' => $requestsWithModules->sortByDesc('created_at')->take(5)->map(function ($req) {\n"},"line_number":366,"absolute_offset":20682,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    return [\n"},"line_number":367,"absolute_offset":20798,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'id' => $req->id,\n"},"line_number":368,"absolute_offset":20827,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'staff_name' => $req->staff_name,\n"},"line_number":369,"absolute_offset":20869,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'status' => $req->status,\n"},"line_number":370,"absolute_offset":20927,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'module_requested_for' => $req->module_requested_for ?? 'use',\n"},"line_number":371,"absolute_offset":20977,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'wellsoft_count' => count($req->wellsoft_modules ?? []),\n"},"line_number":372,"absolute_offset":21064,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'jeeva_count' => count($req->jeeva_modules ?? []),\n"},"line_number":373,"absolute_offset":21145,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'created_at' => $req->created_at->format('Y-m-d H:i:s')\n"},"line_number":374,"absolute_offset":21220,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ];\n"},"line_number":375,"absolute_offset":21300,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                })->values()\n"},"line_number":376,"absolute_offset":21323,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ];\n"},"line_number":377,"absolute_offset":21352,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":378,"absolute_offset":21367,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":379,"absolute_offset":21380,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":380,"absolute_offset":21418,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $stats\n"},"line_number":381,"absolute_offset":21453,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":382,"absolute_offset":21486,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":383,"absolute_offset":21502,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":384,"absolute_offset":21515,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error getting module request statistics', [\n"},"line_number":385,"absolute_offset":21549,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":386,"absolute_offset":21617,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'current_user_id' => $request->user()?->id\n"},"line_number":387,"absolute_offset":21662,"submatches":[{"match":{"text":"user_id' ="},"start":25,"end":35}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":388,"absolute_offset":21721,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":389,"absolute_offset":21737,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":390,"absolute_offset":21750,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":391,"absolute_offset":21788,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to get module request statistics'\n"},"line_number":392,"absolute_offset":21824,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":393,"absolute_offset":21895,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":394,"absolute_offset":21916,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    }\n"},"line_number":395,"absolute_offset":21926,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":396,"absolute_offset":21932,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    /**\n"},"line_number":397,"absolute_offset":21933,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     * ENHANCED: Update HOD approval for a module request with proper file upload and module selection\n"},"line_number":398,"absolute_offset":21941,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":399,"absolute_offset":22044,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function updateHodApproval(Request $request, int $userAccessId): JsonResponse\n"},"line_number":400,"absolute_offset":22052,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":401,"absolute_offset":22141,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":402,"absolute_offset":22147,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $currentUser = $request->user();\n"},"line_number":403,"absolute_offset":22161,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userRoles = $currentUser->roles()->pluck('name')->toArray();\n"},"line_number":404,"absolute_offset":22206,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":405,"absolute_offset":22280,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Check if user is HOD\n"},"line_number":406,"absolute_offset":22293,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!array_intersect($userRoles, ['head_of_department'])) {\n"},"line_number":407,"absolute_offset":22329,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":408,"absolute_offset":22401,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":409,"absolute_offset":22443,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'Access denied. Only HOD can perform this action.'\n"},"line_number":410,"absolute_offset":22483,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":411,"absolute_offset":22567,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":412,"absolute_offset":22592,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":413,"absolute_offset":22606,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::info('ðŸ” HOD APPROVAL UPDATE START', [\n"},"line_number":414,"absolute_offset":22619,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_access_id' => $userAccessId,\n"},"line_number":415,"absolute_offset":22677,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'hod_user_id' => $currentUser->id,\n"},"line_number":416,"absolute_offset":22728,"submatches":[{"match":{"text":"user_id' ="},"start":21,"end":31}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'request_method' => $request->method(),\n"},"line_number":417,"absolute_offset":22779,"submatches":[]}}
{"type":"end","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"binary_offset":null,"stats":{"elapsed":{"secs":0,"nanos":355500,"human":"0.000356s"},"searches":1,"searches_with_match":1,"bytes_searched":22779,"bytes_printed":43152,"matched_lines":4,"matches":4}}}
{"data":{"elapsed_total":{"human":"0.006627s","nanos":6627100,"secs":0},"stats":{"bytes_printed":43152,"bytes_searched":22779,"elapsed":{"human":"0.000356s","nanos":355500,"secs":0},"matched_lines":4,"matches":4,"searches":1,"searches_with_match":1}},"type":"summary"}
