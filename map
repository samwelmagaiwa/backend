{"type":"begin","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"}}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"class BothServiceFormController extends Controller\n"},"line_number":20,"absolute_offset":549,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"{\n"},"line_number":21,"absolute_offset":600,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    /**\n"},"line_number":22,"absolute_offset":602,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     * Get user information for auto-population from user_access table\n"},"line_number":23,"absolute_offset":610,"submatches":[{"match":{"text":"-"},"start":36,"end":37}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":24,"absolute_offset":681,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function getUserInfo(Request $request): JsonResponse\n"},"line_number":25,"absolute_offset":689,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":26,"absolute_offset":753,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":27,"absolute_offset":759,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $user = $request->user();\n"},"line_number":28,"absolute_offset":773,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":29,"absolute_offset":811,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Get latest user access request for department info\n"},"line_number":30,"absolute_offset":824,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $latestAccess = UserAccess::where('user_id', $user->id)\n"},"line_number":31,"absolute_offset":890,"submatches":[{"match":{"text":"-"},"start":62,"end":63}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->with('department')\n"},"line_number":32,"absolute_offset":958,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->latest()\n"},"line_number":33,"absolute_offset":995,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->first();\n"},"line_number":34,"absolute_offset":1022,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":35,"absolute_offset":1049,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":36,"absolute_offset":1050,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":37,"absolute_offset":1088,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => [\n"},"line_number":38,"absolute_offset":1123,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'pf_number' => $user->pf_number ?? '',\n"},"line_number":39,"absolute_offset":1151,"submatches":[{"match":{"text":"-"},"start":40,"end":41}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'staff_name' => $user->name ?? '',\n"},"line_number":40,"absolute_offset":1210,"submatches":[{"match":{"text":"-"},"start":41,"end":42}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'phone_number' => $user->phone ?? '',\n"},"line_number":41,"absolute_offset":1265,"submatches":[{"match":{"text":"-"},"start":43,"end":44}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'department_id' => $latestAccess?->department_id,\n"},"line_number":42,"absolute_offset":1323,"submatches":[{"match":{"text":"-"},"start":53,"end":54}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'department_name' => $latestAccess?->department?->name,\n"},"line_number":43,"absolute_offset":1393,"submatches":[{"match":{"text":"-"},"start":55,"end":56},{"match":{"text":"-"},"start":68,"end":69}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'role' => $user->role?->name ?? '',\n"},"line_number":44,"absolute_offset":1469,"submatches":[{"match":{"text":"-"},"start":35,"end":36},{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ]\n"},"line_number":45,"absolute_offset":1525,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":46,"absolute_offset":1543,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":47,"absolute_offset":1559,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error getting user info for both-service-form', [\n"},"line_number":48,"absolute_offset":1593,"submatches":[{"match":{"text":"-"},"start":56,"end":57},{"match":{"text":"-"},"start":64,"end":65}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":49,"absolute_offset":1667,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $request->user()?->id\n"},"line_number":50,"absolute_offset":1712,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":51,"absolute_offset":1763,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":52,"absolute_offset":1779,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":53,"absolute_offset":1780,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":54,"absolute_offset":1818,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to get user information'\n"},"line_number":55,"absolute_offset":1854,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":56,"absolute_offset":1916,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function getPersonalInfoFromUserAccess(Request $request, int $userAccessId): JsonResponse\n"},"line_number":63,"absolute_offset":2043,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":64,"absolute_offset":2144,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":65,"absolute_offset":2150,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $currentUser = $request->user();\n"},"line_number":66,"absolute_offset":2164,"submatches":[{"match":{"text":"-"},"start":35,"end":36}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userRoles = $currentUser->roles()->pluck('name')->toArray();\n"},"line_number":67,"absolute_offset":2209,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47},{"match":{"text":"-"},"start":61,"end":62}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userRole = $currentUser->getPrimaryRole()?->name; // For backward compatibility\n"},"line_number":68,"absolute_offset":2283,"submatches":[{"match":{"text":"-"},"start":36,"end":37},{"match":{"text":"-"},"start":55,"end":56}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":69,"absolute_offset":2376,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Check if user has permission to access this data\n"},"line_number":70,"absolute_offset":2377,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $allowedRoles = ['head_of_department', 'divisional_director', 'ict_director', 'ict_officer', 'admin', 'super_admin'];\n"},"line_number":71,"absolute_offset":2441,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!array_intersect($userRoles, $allowedRoles)) {\n"},"line_number":72,"absolute_offset":2571,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":73,"absolute_offset":2634,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":74,"absolute_offset":2676,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'Access denied. Insufficient permissions.'\n"},"line_number":75,"absolute_offset":2716,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":76,"absolute_offset":2792,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":78,"absolute_offset":2831,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Get user access record with related data\n"},"line_number":79,"absolute_offset":2832,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userAccess = UserAccess::with(['user', 'department'])\n"},"line_number":80,"absolute_offset":2888,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->findOrFail($userAccessId);\n"},"line_number":81,"absolute_offset":2955,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":82,"absolute_offset":3000,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // For HOD, ensure they can only access requests from their department\n"},"line_number":83,"absolute_offset":3001,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (array_intersect($userRoles, ['head_of_department'])) {\n"},"line_number":84,"absolute_offset":3084,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $hodDepartment = Department::where('hod_user_id', $currentUser->id)->first();\n"},"line_number":85,"absolute_offset":3155,"submatches":[{"match":{"text":"-"},"start":78,"end":79},{"match":{"text":"-"},"start":83,"end":84}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                if (!$hodDepartment || $userAccess->department_id !== $hodDepartment->id) {\n"},"line_number":86,"absolute_offset":3249,"submatches":[{"match":{"text":"-"},"start":50,"end":51},{"match":{"text":"-"},"start":84,"end":85}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    return response()->json([\n"},"line_number":87,"absolute_offset":3341,"submatches":[{"match":{"text":"-"},"start":37,"end":38}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'success' => false,\n"},"line_number":88,"absolute_offset":3387,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'message' => 'Access denied. You can only access requests from your department.'\n"},"line_number":89,"absolute_offset":3431,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ], 403);\n"},"line_number":90,"absolute_offset":3536,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":93,"absolute_offset":3597,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Prepare personal information data\n"},"line_number":94,"absolute_offset":3598,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $personalInfo = [\n"},"line_number":95,"absolute_offset":3647,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'pf_number' => $userAccess->pf_number,\n"},"line_number":96,"absolute_offset":3677,"submatches":[{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'staff_name' => $userAccess->staff_name,\n"},"line_number":97,"absolute_offset":3732,"submatches":[{"match":{"text":"-"},"start":43,"end":44}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'department' => $userAccess->department?->name ?? 'N/A',\n"},"line_number":98,"absolute_offset":3789,"submatches":[{"match":{"text":"-"},"start":43,"end":44},{"match":{"text":"-"},"start":56,"end":57}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'department_id' => $userAccess->department_id,\n"},"line_number":99,"absolute_offset":3862,"submatches":[{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'contact_number' => $userAccess->phone_number,\n"},"line_number":100,"absolute_offset":3925,"submatches":[{"match":{"text":"-"},"start":47,"end":48}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'signature' => [\n"},"line_number":101,"absolute_offset":3988,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'path' => $userAccess->signature_path,\n"},"line_number":102,"absolute_offset":4021,"submatches":[{"match":{"text":"-"},"start":41,"end":42}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'url' => $userAccess->signature_path ? Storage::url($userAccess->signature_path) : null,\n"},"line_number":103,"absolute_offset":4080,"submatches":[{"match":{"text":"-"},"start":40,"end":41},{"match":{"text":"-"},"start":83,"end":84}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'exists' => $userAccess->signature_path ? Storage::exists($userAccess->signature_path) : false\n"},"line_number":104,"absolute_offset":4189,"submatches":[{"match":{"text":"-"},"start":43,"end":44},{"match":{"text":"-"},"start":89,"end":90}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ],\n"},"line_number":105,"absolute_offset":4304,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'request_details' => [\n"},"line_number":106,"absolute_offset":4323,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'id' => $userAccess->id,\n"},"line_number":107,"absolute_offset":4362,"submatches":[{"match":{"text":"-"},"start":39,"end":40}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'request_type' => $userAccess->request_type,\n"},"line_number":108,"absolute_offset":4407,"submatches":[{"match":{"text":"-"},"start":49,"end":50}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'purpose' => $userAccess->purpose,\n"},"line_number":109,"absolute_offset":4472,"submatches":[{"match":{"text":"-"},"start":44,"end":45}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'status' => $userAccess->status,\n"},"line_number":110,"absolute_offset":4527,"submatches":[{"match":{"text":"-"},"start":43,"end":44}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'created_at' => $userAccess->created_at->format('Y-m-d H:i:s'),\n"},"line_number":111,"absolute_offset":4580,"submatches":[{"match":{"text":"-"},"start":47,"end":48},{"match":{"text":"-"},"start":59,"end":60},{"match":{"text":"-"},"start":70,"end":71},{"match":{"text":"-"},"start":72,"end":73}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'updated_at' => $userAccess->updated_at->format('Y-m-d H:i:s')\n"},"line_number":112,"absolute_offset":4664,"submatches":[{"match":{"text":"-"},"start":47,"end":48},{"match":{"text":"-"},"start":59,"end":60},{"match":{"text":"-"},"start":70,"end":71},{"match":{"text":"-"},"start":72,"end":73}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ],\n"},"line_number":113,"absolute_offset":4747,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_details' => [\n"},"line_number":114,"absolute_offset":4766,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'id' => $userAccess->user->id,\n"},"line_number":115,"absolute_offset":4802,"submatches":[{"match":{"text":"-"},"start":39,"end":40},{"match":{"text":"-"},"start":45,"end":46}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'email' => $userAccess->user->email,\n"},"line_number":116,"absolute_offset":4853,"submatches":[{"match":{"text":"-"},"start":42,"end":43},{"match":{"text":"-"},"start":48,"end":49}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'role' => $userAccess->user->role?->name ?? 'N/A'\n"},"line_number":117,"absolute_offset":4910,"submatches":[{"match":{"text":"-"},"start":41,"end":42},{"match":{"text":"-"},"start":47,"end":48},{"match":{"text":"-"},"start":54,"end":55}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ]\n"},"line_number":118,"absolute_offset":4980,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ];\n"},"line_number":119,"absolute_offset":4998,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":120,"absolute_offset":5013,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":121,"absolute_offset":5014,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":122,"absolute_offset":5052,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $personalInfo,\n"},"line_number":123,"absolute_offset":5087,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'meta' => [\n"},"line_number":124,"absolute_offset":5128,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'accessed_by' => $currentUser->name,\n"},"line_number":125,"absolute_offset":5156,"submatches":[{"match":{"text":"-"},"start":49,"end":50}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'accessed_by_role' => $userRole,\n"},"line_number":126,"absolute_offset":5213,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'access_time' => now()->format('Y-m-d H:i:s')\n"},"line_number":127,"absolute_offset":5266,"submatches":[{"match":{"text":"-"},"start":42,"end":43},{"match":{"text":"-"},"start":53,"end":54},{"match":{"text":"-"},"start":55,"end":56}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ]\n"},"line_number":128,"absolute_offset":5332,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":129,"absolute_offset":5350,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":130,"absolute_offset":5366,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":131,"absolute_offset":5367,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error getting personal info from user_access', [\n"},"line_number":132,"absolute_offset":5401,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":133,"absolute_offset":5474,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_access_id' => $userAccessId,\n"},"line_number":134,"absolute_offset":5519,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'current_user_id' => $request->user()?->id\n"},"line_number":135,"absolute_offset":5570,"submatches":[{"match":{"text":"-"},"start":45,"end":46},{"match":{"text":"-"},"start":54,"end":55}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":136,"absolute_offset":5629,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":137,"absolute_offset":5645,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":138,"absolute_offset":5646,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":139,"absolute_offset":5684,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to get personal information'\n"},"line_number":140,"absolute_offset":5720,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":141,"absolute_offset":5786,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function getUserAccessRequestsForHOD(Request $request): JsonResponse\n"},"line_number":149,"absolute_offset":5975,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":150,"absolute_offset":6055,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":151,"absolute_offset":6061,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $currentUser = $request->user();\n"},"line_number":152,"absolute_offset":6075,"submatches":[{"match":{"text":"-"},"start":35,"end":36}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userRoles = $currentUser->roles()->pluck('name')->toArray();\n"},"line_number":153,"absolute_offset":6120,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47},{"match":{"text":"-"},"start":61,"end":62}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userRole = $currentUser->getPrimaryRole()?->name; // For backward compatibility\n"},"line_number":154,"absolute_offset":6194,"submatches":[{"match":{"text":"-"},"start":36,"end":37},{"match":{"text":"-"},"start":55,"end":56}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":155,"absolute_offset":6287,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Check if user has approval permissions\n"},"line_number":156,"absolute_offset":6288,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!array_intersect($userRoles, ['head_of_department', 'divisional_director'])) {\n"},"line_number":157,"absolute_offset":6342,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":158,"absolute_offset":6437,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":159,"absolute_offset":6479,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'Access denied. Only HOD and Divisional Director can access this endpoint.'\n"},"line_number":160,"absolute_offset":6519,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":161,"absolute_offset":6628,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":163,"absolute_offset":6667,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Get user's department based on role\n"},"line_number":164,"absolute_offset":6668,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::info('Department Lookup Debug', [\n"},"line_number":165,"absolute_offset":6719,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'current_user_id' => $currentUser->id,\n"},"line_number":166,"absolute_offset":6770,"submatches":[{"match":{"text":"-"},"start":49,"end":50}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'current_user_email' => $currentUser->email,\n"},"line_number":167,"absolute_offset":6825,"submatches":[{"match":{"text":"-"},"start":52,"end":53}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'current_user_roles' => $userRoles,\n"},"line_number":168,"absolute_offset":6886,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'primary_role' => $userRole,\n"},"line_number":169,"absolute_offset":6938,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":170,"absolute_offset":6983,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":173,"absolute_offset":7048,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // For HOD, find department where they are assigned as HOD\n"},"line_number":174,"absolute_offset":7061,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (array_intersect($userRoles, ['head_of_department'])) {\n"},"line_number":175,"absolute_offset":7132,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $userDepartment = Department::where('hod_user_id', $currentUser->id)->first();\n"},"line_number":176,"absolute_offset":7203,"submatches":[{"match":{"text":"-"},"start":79,"end":80},{"match":{"text":"-"},"start":84,"end":85}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":177,"absolute_offset":7298,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":178,"absolute_offset":7312,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // For Divisional Director, find department where they are assigned as divisional director\n"},"line_number":179,"absolute_offset":7325,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (array_intersect($userRoles, ['divisional_director']) && !$userDepartment) {\n"},"line_number":180,"absolute_offset":7428,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $userDepartment = Department::where('divisional_director_id', $currentUser->id)->first();\n"},"line_number":181,"absolute_offset":7520,"submatches":[{"match":{"text":"-"},"start":90,"end":91},{"match":{"text":"-"},"start":95,"end":96}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":182,"absolute_offset":7626,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":183,"absolute_offset":7640,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Debug: Log all departments and their assignments\n"},"line_number":184,"absolute_offset":7653,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $allDepartments = Department::select('id', 'name', 'code', 'hod_user_id', 'divisional_director_id')->get();\n"},"line_number":185,"absolute_offset":7717,"submatches":[{"match":{"text":"-"},"start":111,"end":112}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::info('All Departments Debug', [\n"},"line_number":186,"absolute_offset":7837,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'departments' => $allDepartments->toArray()\n"},"line_number":187,"absolute_offset":7886,"submatches":[{"match":{"text":"-"},"start":48,"end":49}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":188,"absolute_offset":7946,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":189,"absolute_offset":7962,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!$userDepartment) {\n"},"line_number":190,"absolute_offset":7975,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                Log::error('No department found for user', [\n"},"line_number":191,"absolute_offset":8011,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'user_id' => $currentUser->id,\n"},"line_number":192,"absolute_offset":8072,"submatches":[{"match":{"text":"-"},"start":45,"end":46}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'user_email' => $currentUser->email,\n"},"line_number":193,"absolute_offset":8123,"submatches":[{"match":{"text":"-"},"start":48,"end":49}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'user_roles' => $userRoles,\n"},"line_number":194,"absolute_offset":8180,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'all_departments' => $allDepartments->toArray()\n"},"line_number":195,"absolute_offset":8228,"submatches":[{"match":{"text":"-"},"start":56,"end":57}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ]);\n"},"line_number":196,"absolute_offset":8296,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                \n"},"line_number":197,"absolute_offset":8316,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":198,"absolute_offset":8333,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":199,"absolute_offset":8375,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'No department assigned to user.',\n"},"line_number":200,"absolute_offset":8415,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'debug' => [\n"},"line_number":201,"absolute_offset":8483,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'user_id' => $currentUser->id,\n"},"line_number":202,"absolute_offset":8516,"submatches":[{"match":{"text":"-"},"start":49,"end":50}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'user_email' => $currentUser->email,\n"},"line_number":203,"absolute_offset":8571,"submatches":[{"match":{"text":"-"},"start":52,"end":53}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'user_roles' => $userRoles,\n"},"line_number":204,"absolute_offset":8632,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'departments_count' => $allDepartments->count(),\n"},"line_number":205,"absolute_offset":8684,"submatches":[{"match":{"text":"-"},"start":62,"end":63}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'departments_with_hod' => $allDepartments->whereNotNull('hod_user_id')->values(),\n"},"line_number":206,"absolute_offset":8757,"submatches":[{"match":{"text":"-"},"start":65,"end":66},{"match":{"text":"-"},"start":94,"end":95}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'departments_with_divisional_director' => $allDepartments->whereNotNull('divisional_director_id')->values()\n"},"line_number":207,"absolute_offset":8863,"submatches":[{"match":{"text":"-"},"start":81,"end":82},{"match":{"text":"-"},"start":121,"end":122}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ]\n"},"line_number":208,"absolute_offset":8995,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 404);\n"},"line_number":209,"absolute_offset":9017,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":210,"absolute_offset":9042,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":211,"absolute_offset":9056,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Get user access requests from user's department\n"},"line_number":212,"absolute_offset":9057,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userAccessRequests = UserAccess::with(['user', 'department'])\n"},"line_number":213,"absolute_offset":9120,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->where('department_id', $userDepartment->id)\n"},"line_number":214,"absolute_offset":9195,"submatches":[{"match":{"text":"-"},"start":16,"end":17},{"match":{"text":"-"},"start":56,"end":57}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->where('status', 'pending') // Only pending requests for approval\n"},"line_number":215,"absolute_offset":9257,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->orderBy('created_at', 'asc') // FIFO order\n"},"line_number":216,"absolute_offset":9340,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->get();\n"},"line_number":217,"absolute_offset":9401,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":218,"absolute_offset":9426,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Transform data for approval dashboard\n"},"line_number":219,"absolute_offset":9427,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $requestsData = $userAccessRequests->map(function ($userAccess) {\n"},"line_number":220,"absolute_offset":9480,"submatches":[{"match":{"text":"-"},"start":47,"end":48}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return [\n"},"line_number":221,"absolute_offset":9558,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'id' => $userAccess->id,\n"},"line_number":222,"absolute_offset":9583,"submatches":[{"match":{"text":"-"},"start":39,"end":40}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'personal_information' => [\n"},"line_number":223,"absolute_offset":9628,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'pf_number' => $userAccess->pf_number,\n"},"line_number":224,"absolute_offset":9676,"submatches":[{"match":{"text":"-"},"start":50,"end":51}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'staff_name' => $userAccess->staff_name,\n"},"line_number":225,"absolute_offset":9739,"submatches":[{"match":{"text":"-"},"start":51,"end":52}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'department' => $userAccess->department?->name ?? 'N/A',\n"},"line_number":226,"absolute_offset":9804,"submatches":[{"match":{"text":"-"},"start":51,"end":52},{"match":{"text":"-"},"start":64,"end":65}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'contact_number' => $userAccess->phone_number,\n"},"line_number":227,"absolute_offset":9885,"submatches":[{"match":{"text":"-"},"start":55,"end":56}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'signature' => [\n"},"line_number":228,"absolute_offset":9956,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'exists' => $userAccess->signature_path ? true : false,\n"},"line_number":229,"absolute_offset":9997,"submatches":[{"match":{"text":"-"},"start":51,"end":52}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'url' => $userAccess->signature_path ? Storage::url($userAccess->signature_path) : null,\n"},"line_number":230,"absolute_offset":10081,"submatches":[{"match":{"text":"-"},"start":48,"end":49},{"match":{"text":"-"},"start":91,"end":92}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'status' => $userAccess->signature_path ? 'Uploaded' : 'No signature uploaded'\n"},"line_number":231,"absolute_offset":10198,"submatches":[{"match":{"text":"-"},"start":51,"end":52}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        ]\n"},"line_number":232,"absolute_offset":10305,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ],\n"},"line_number":233,"absolute_offset":10331,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'request_details' => [\n"},"line_number":234,"absolute_offset":10354,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'request_type' => $userAccess->request_type,\n"},"line_number":235,"absolute_offset":10397,"submatches":[{"match":{"text":"-"},"start":53,"end":54}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'purpose' => $userAccess->purpose,\n"},"line_number":236,"absolute_offset":10466,"submatches":[{"match":{"text":"-"},"start":48,"end":49}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'status' => $userAccess->status,\n"},"line_number":237,"absolute_offset":10525,"submatches":[{"match":{"text":"-"},"start":47,"end":48}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'submission_date' => $userAccess->created_at->format('Y-m-d'),\n"},"line_number":238,"absolute_offset":10582,"submatches":[{"match":{"text":"-"},"start":56,"end":57},{"match":{"text":"-"},"start":68,"end":69},{"match":{"text":"-"},"start":79,"end":80},{"match":{"text":"-"},"start":81,"end":82}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'submission_time' => $userAccess->created_at->format('H:i:s'),\n"},"line_number":239,"absolute_offset":10669,"submatches":[{"match":{"text":"-"},"start":56,"end":57},{"match":{"text":"-"},"start":68,"end":69}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'days_pending' => $userAccess->created_at->diffInDays(now())\n"},"line_number":240,"absolute_offset":10756,"submatches":[{"match":{"text":"-"},"start":53,"end":54},{"match":{"text":"-"},"start":65,"end":66}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ],\n"},"line_number":241,"absolute_offset":10841,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'user_info' => [\n"},"line_number":242,"absolute_offset":10864,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'email' => $userAccess->user->email,\n"},"line_number":243,"absolute_offset":10901,"submatches":[{"match":{"text":"-"},"start":46,"end":47},{"match":{"text":"-"},"start":52,"end":53}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'role' => $userAccess->user->role?->name ?? 'N/A'\n"},"line_number":244,"absolute_offset":10962,"submatches":[{"match":{"text":"-"},"start":45,"end":46},{"match":{"text":"-"},"start":51,"end":52},{"match":{"text":"-"},"start":58,"end":59}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ],\n"},"line_number":245,"absolute_offset":11036,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'actions' => [\n"},"line_number":246,"absolute_offset":11059,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'can_view' => true,\n"},"line_number":247,"absolute_offset":11094,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ];\n"},"line_number":252,"absolute_offset":11305,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            });\n"},"line_number":253,"absolute_offset":11324,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":254,"absolute_offset":11340,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":255,"absolute_offset":11341,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":256,"absolute_offset":11379,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $requestsData,\n"},"line_number":257,"absolute_offset":11414,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'meta' => [\n"},"line_number":258,"absolute_offset":11455,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'total_requests' => $requestsData->count(),\n"},"line_number":259,"absolute_offset":11483,"submatches":[{"match":{"text":"-"},"start":53,"end":54}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'department' => $userDepartment->name,\n"},"line_number":260,"absolute_offset":11547,"submatches":[{"match":{"text":"-"},"start":51,"end":52}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approver_name' => $currentUser->name,\n"},"line_number":261,"absolute_offset":11606,"submatches":[{"match":{"text":"-"},"start":51,"end":52}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approver_role' => $userRole,\n"},"line_number":262,"absolute_offset":11665,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'last_updated' => now()->format('Y-m-d H:i:s')\n"},"line_number":263,"absolute_offset":11715,"submatches":[{"match":{"text":"-"},"start":43,"end":44},{"match":{"text":"-"},"start":54,"end":55},{"match":{"text":"-"},"start":56,"end":57}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ]\n"},"line_number":264,"absolute_offset":11782,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":265,"absolute_offset":11800,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":266,"absolute_offset":11816,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":267,"absolute_offset":11817,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error getting user access requests for HOD', [\n"},"line_number":268,"absolute_offset":11851,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":269,"absolute_offset":11922,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $request->user()?->id\n"},"line_number":270,"absolute_offset":11967,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":271,"absolute_offset":12018,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":272,"absolute_offset":12034,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":273,"absolute_offset":12035,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":274,"absolute_offset":12073,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to get user access requests'\n"},"line_number":275,"absolute_offset":12109,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":276,"absolute_offset":12175,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":284,"absolute_offset":12308,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":285,"absolute_offset":12314,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $departments = Department::active()\n"},"line_number":286,"absolute_offset":12328,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->select('id', 'name', 'code')\n"},"line_number":287,"absolute_offset":12376,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->orderBy('name')\n"},"line_number":288,"absolute_offset":12423,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->get();\n"},"line_number":289,"absolute_offset":12457,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":290,"absolute_offset":12482,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":291,"absolute_offset":12483,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":292,"absolute_offset":12521,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $departments\n"},"line_number":293,"absolute_offset":12556,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":294,"absolute_offset":12595,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":295,"absolute_offset":12611,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error getting departments', ['error' => $e->getMessage()]);\n"},"line_number":296,"absolute_offset":12645,"submatches":[{"match":{"text":"-"},"start":66,"end":67}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":297,"absolute_offset":12729,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":298,"absolute_offset":12730,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":299,"absolute_offset":12768,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to get departments'\n"},"line_number":300,"absolute_offset":12804,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":301,"absolute_offset":12861,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    }\n"},"line_number":303,"absolute_offset":12892,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":304,"absolute_offset":12898,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    /**\n"},"line_number":305,"absolute_offset":12899,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     * Create a new both-service-form request\n"},"line_number":306,"absolute_offset":12907,"submatches":[{"match":{"text":"-"},"start":24,"end":25},{"match":{"text":"-"},"start":32,"end":33}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":307,"absolute_offset":12953,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function store(CreateBothServiceFormRequest $request): JsonResponse\n"},"line_number":308,"absolute_offset":12961,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":309,"absolute_offset":13040,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":310,"absolute_offset":13046,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $user = $request->user();\n"},"line_number":311,"absolute_offset":13060,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":312,"absolute_offset":13098,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Get validated data from the request\n"},"line_number":313,"absolute_offset":13111,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $validated = $request->validated();\n"},"line_number":314,"absolute_offset":13162,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":315,"absolute_offset":13210,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            DB::beginTransaction();\n"},"line_number":316,"absolute_offset":13211,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":317,"absolute_offset":13247,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Handle signature upload\n"},"line_number":318,"absolute_offset":13248,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $signaturePath = null;\n"},"line_number":319,"absolute_offset":13287,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if ($request->hasFile('signature')) {\n"},"line_number":320,"absolute_offset":13322,"submatches":[{"match":{"text":"-"},"start":24,"end":25}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $signaturePath = $request->file('signature')->store('signatures/both-service-forms', 'public');\n"},"line_number":321,"absolute_offset":13372,"submatches":[{"match":{"text":"-"},"start":41,"end":42},{"match":{"text":"-"},"start":60,"end":61},{"match":{"text":"-"},"start":84,"end":85},{"match":{"text":"-"},"start":92,"end":93}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":322,"absolute_offset":13484,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":323,"absolute_offset":13498,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Create the both-service-form request\n"},"line_number":324,"absolute_offset":13499,"submatches":[{"match":{"text":"-"},"start":30,"end":31},{"match":{"text":"-"},"start":38,"end":39}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $bothServiceForm = ModuleAccessRequest::create([\n"},"line_number":325,"absolute_offset":13551,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $user->id,\n"},"line_number":326,"absolute_offset":13612,"submatches":[{"match":{"text":"-"},"start":34,"end":35}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'form_type' => ModuleAccessRequest::FORM_TYPE_BOTH_SERVICE,\n"},"line_number":327,"absolute_offset":13652,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'services_requested' => $validated['services_requested'],\n"},"line_number":328,"absolute_offset":13728,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'access_type' => $validated['access_type'],\n"},"line_number":329,"absolute_offset":13802,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'current_approval_stage' => ModuleAccessRequest::STAGE_HOD,\n"},"line_number":336,"absolute_offset":14247,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":337,"absolute_offset":14323,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":338,"absolute_offset":14339,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Auto-populate personal information\n"},"line_number":339,"absolute_offset":14340,"submatches":[{"match":{"text":"-"},"start":19,"end":20}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $bothServiceForm->populatePersonalInfo();\n"},"line_number":340,"absolute_offset":14390,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $bothServiceForm->save();\n"},"line_number":341,"absolute_offset":14444,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":342,"absolute_offset":14482,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            DB::commit();\n"},"line_number":343,"absolute_offset":14483,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":344,"absolute_offset":14509,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::info('Both-service-form created successfully', [\n"},"line_number":345,"absolute_offset":14510,"submatches":[{"match":{"text":"-"},"start":27,"end":28},{"match":{"text":"-"},"start":35,"end":36}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'form_id' => $bothServiceForm->id,\n"},"line_number":346,"absolute_offset":14576,"submatches":[{"match":{"text":"-"},"start":45,"end":46}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $user->id,\n"},"line_number":347,"absolute_offset":14627,"submatches":[{"match":{"text":"-"},"start":34,"end":35}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'services' => $validated['services_requested']\n"},"line_number":348,"absolute_offset":14667,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":349,"absolute_offset":14730,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":350,"absolute_offset":14746,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":351,"absolute_offset":14747,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":352,"absolute_offset":14785,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Both-service-form request submitted successfully',\n"},"line_number":353,"absolute_offset":14820,"submatches":[{"match":{"text":"-"},"start":34,"end":35},{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $bothServiceForm->load(['user', 'department'])\n"},"line_number":354,"absolute_offset":14901,"submatches":[{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 201);\n"},"line_number":355,"absolute_offset":14974,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":356,"absolute_offset":14995,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (ValidationException $e) {\n"},"line_number":357,"absolute_offset":14996,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            DB::rollBack();\n"},"line_number":358,"absolute_offset":15039,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":359,"absolute_offset":15067,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":360,"absolute_offset":15105,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Validation failed',\n"},"line_number":361,"absolute_offset":15141,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'errors' => $e->errors()\n"},"line_number":362,"absolute_offset":15191,"submatches":[{"match":{"text":"-"},"start":30,"end":31}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 422);\n"},"line_number":363,"absolute_offset":15232,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":364,"absolute_offset":15253,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            DB::rollBack();\n"},"line_number":365,"absolute_offset":15287,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error creating both-service-form', [\n"},"line_number":366,"absolute_offset":15315,"submatches":[{"match":{"text":"-"},"start":43,"end":44},{"match":{"text":"-"},"start":51,"end":52}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":367,"absolute_offset":15376,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $request->user()?->id\n"},"line_number":368,"absolute_offset":15421,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":369,"absolute_offset":15472,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":370,"absolute_offset":15488,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":371,"absolute_offset":15489,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":372,"absolute_offset":15527,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to create both-service-form request'\n"},"line_number":373,"absolute_offset":15563,"submatches":[{"match":{"text":"-"},"start":51,"end":52},{"match":{"text":"-"},"start":59,"end":60}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":374,"absolute_offset":15637,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":375,"absolute_offset":15658,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    }\n"},"line_number":376,"absolute_offset":15668,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function index(Request $request): JsonResponse\n"},"line_number":381,"absolute_offset":15736,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":382,"absolute_offset":15794,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":383,"absolute_offset":15800,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $user = $request->user();\n"},"line_number":384,"absolute_offset":15814,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userRole = $user->role?->name;\n"},"line_number":385,"absolute_offset":15852,"submatches":[{"match":{"text":"-"},"start":29,"end":30},{"match":{"text":"-"},"start":36,"end":37}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":386,"absolute_offset":15896,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!$userRole) {\n"},"line_number":387,"absolute_offset":15897,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":388,"absolute_offset":15927,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":389,"absolute_offset":15969,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'User role not found'\n"},"line_number":390,"absolute_offset":16009,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":391,"absolute_offset":16064,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":392,"absolute_offset":16089,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":393,"absolute_offset":16103,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $query = ModuleAccessRequest::bothServiceForm()\n"},"line_number":394,"absolute_offset":16104,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->with(['user', 'department', 'hodUser', 'divisionalDirectorUser', 'dictUser', 'hodItUser', 'ictOfficerUser']);\n"},"line_number":395,"absolute_offset":16164,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":396,"absolute_offset":16292,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Filter based on user role\n"},"line_number":397,"absolute_offset":16293,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (in_array($userRole, ['head_of_department'])) {\n"},"line_number":398,"absolute_offset":16334,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                // HOD can see forms from their department\n"},"line_number":399,"absolute_offset":16397,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $query->whereHas('department', function ($q) use ($user) {\n"},"line_number":400,"absolute_offset":16456,"submatches":[{"match":{"text":"-"},"start":22,"end":23}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    $q->where('hod_user_id', $user->id);\n"},"line_number":401,"absolute_offset":16531,"submatches":[{"match":{"text":"-"},"start":22,"end":23},{"match":{"text":"-"},"start":50,"end":51}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                });\n"},"line_number":402,"absolute_offset":16588,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            } elseif (in_array($userRole, ['divisional_director', 'ict_director', 'ict_officer'])) {\n"},"line_number":403,"absolute_offset":16608,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                // Other approvers can see forms in their approval stage\n"},"line_number":404,"absolute_offset":16709,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $query->forRole($userRole);\n"},"line_number":405,"absolute_offset":16782,"submatches":[{"match":{"text":"-"},"start":22,"end":23}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            } else {\n"},"line_number":406,"absolute_offset":16826,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                // Regular users can only see their own forms\n"},"line_number":407,"absolute_offset":16847,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $query->where('user_id', $user->id);\n"},"line_number":408,"absolute_offset":16909,"submatches":[{"match":{"text":"-"},"start":22,"end":23},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":409,"absolute_offset":16962,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":410,"absolute_offset":16976,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $forms = $query->orderBy('created_at', 'desc')->paginate(15);\n"},"line_number":411,"absolute_offset":16977,"submatches":[{"match":{"text":"-"},"start":27,"end":28},{"match":{"text":"-"},"start":58,"end":59}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":412,"absolute_offset":17051,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":413,"absolute_offset":17052,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":414,"absolute_offset":17090,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $forms\n"},"line_number":415,"absolute_offset":17125,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":416,"absolute_offset":17158,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":417,"absolute_offset":17174,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":418,"absolute_offset":17175,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error getting both-service-forms', [\n"},"line_number":419,"absolute_offset":17209,"submatches":[{"match":{"text":"-"},"start":42,"end":43},{"match":{"text":"-"},"start":50,"end":51}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":420,"absolute_offset":17270,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $request->user()?->id\n"},"line_number":421,"absolute_offset":17315,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":422,"absolute_offset":17366,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":423,"absolute_offset":17382,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":424,"absolute_offset":17383,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":425,"absolute_offset":17421,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to get forms'\n"},"line_number":426,"absolute_offset":17457,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":427,"absolute_offset":17508,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    }\n"},"line_number":429,"absolute_offset":17539,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":430,"absolute_offset":17545,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    /**\n"},"line_number":431,"absolute_offset":17546,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     * Get a specific form with role-based access\n"},"line_number":432,"absolute_offset":17554,"submatches":[{"match":{"text":"-"},"start":36,"end":37}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":433,"absolute_offset":17604,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function show(Request $request, int $id): JsonResponse\n"},"line_number":434,"absolute_offset":17612,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":435,"absolute_offset":17678,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":436,"absolute_offset":17684,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $user = $request->user();\n"},"line_number":437,"absolute_offset":17698,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $form = ModuleAccessRequest::bothServiceForm()\n"},"line_number":438,"absolute_offset":17736,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->with(['user', 'department', 'hodUser', 'divisionalDirectorUser', 'dictUser', 'hodItUser', 'ictOfficerUser'])\n"},"line_number":439,"absolute_offset":17795,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->findOrFail($id);\n"},"line_number":440,"absolute_offset":17922,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":441,"absolute_offset":17957,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Check if user can view this form\n"},"line_number":442,"absolute_offset":17958,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!$this->canUserViewForm($user, $form)) {\n"},"line_number":443,"absolute_offset":18006,"submatches":[{"match":{"text":"-"},"start":22,"end":23}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":444,"absolute_offset":18063,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":445,"absolute_offset":18105,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'Unauthorized to view this form'\n"},"line_number":446,"absolute_offset":18145,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":447,"absolute_offset":18211,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":448,"absolute_offset":18236,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":449,"absolute_offset":18250,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Add role-based field access information\n"},"line_number":450,"absolute_offset":18251,"submatches":[{"match":{"text":"-"},"start":23,"end":24}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $formData = $form->toArray();\n"},"line_number":451,"absolute_offset":18306,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $formData['user_permissions'] = $this->getUserPermissions($user, $form);\n"},"line_number":452,"absolute_offset":18348,"submatches":[{"match":{"text":"-"},"start":49,"end":50}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":453,"absolute_offset":18433,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":454,"absolute_offset":18434,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":455,"absolute_offset":18472,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $formData\n"},"line_number":456,"absolute_offset":18507,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":457,"absolute_offset":18543,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":458,"absolute_offset":18559,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":459,"absolute_offset":18560,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error getting both-service-form', [\n"},"line_number":460,"absolute_offset":18594,"submatches":[{"match":{"text":"-"},"start":42,"end":43},{"match":{"text":"-"},"start":50,"end":51}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":461,"absolute_offset":18654,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'form_id' => $id,\n"},"line_number":462,"absolute_offset":18699,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $request->user()?->id\n"},"line_number":463,"absolute_offset":18733,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":464,"absolute_offset":18784,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":465,"absolute_offset":18800,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":466,"absolute_offset":18801,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":467,"absolute_offset":18839,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to get form'\n"},"line_number":468,"absolute_offset":18875,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":469,"absolute_offset":18925,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":475,"absolute_offset":19011,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function approveAsHOD(Request $request, int $id): JsonResponse\n"},"line_number":476,"absolute_offset":19019,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":477,"absolute_offset":19093,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        return $this->processApproval($request, $id, 'hod', [\n"},"line_number":478,"absolute_offset":19099,"submatches":[{"match":{"text":"-"},"start":20,"end":21}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'action' => 'required|in:approve,reject',\n"},"line_number":479,"absolute_offset":19161,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'comments' => 'required|string|min:10|max:1000', // HOD comments are required\n"},"line_number":480,"absolute_offset":19215,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'signature' => 'required|file|mimes:png,jpg,jpeg|max:2048',\n"},"line_number":481,"absolute_offset":19305,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":487,"absolute_offset":19440,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function approveAsDivisionalDirector(Request $request, int $id): JsonResponse\n"},"line_number":488,"absolute_offset":19448,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":489,"absolute_offset":19537,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        return $this->processApproval($request, $id, 'divisional_director', [\n"},"line_number":490,"absolute_offset":19543,"submatches":[{"match":{"text":"-"},"start":20,"end":21}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'action' => 'required|in:approve,reject',\n"},"line_number":491,"absolute_offset":19621,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'comments' => 'nullable|string|max:1000',\n"},"line_number":492,"absolute_offset":19675,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'signature' => 'required|file|mimes:png,jpg,jpeg|max:2048',\n"},"line_number":493,"absolute_offset":19729,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":499,"absolute_offset":19849,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function approveAsDICT(Request $request, int $id): JsonResponse\n"},"line_number":500,"absolute_offset":19857,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":501,"absolute_offset":19932,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        return $this->processApproval($request, $id, 'dict', [\n"},"line_number":502,"absolute_offset":19938,"submatches":[{"match":{"text":"-"},"start":20,"end":21}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'action' => 'required|in:approve,reject',\n"},"line_number":503,"absolute_offset":20001,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'comments' => 'nullable|string|max:1000',\n"},"line_number":504,"absolute_offset":20055,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'signature' => 'required|file|mimes:png,jpg,jpeg|max:2048',\n"},"line_number":505,"absolute_offset":20109,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function approveAsHODIT(Request $request, int $id): JsonResponse\n"},"line_number":512,"absolute_offset":20243,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":513,"absolute_offset":20319,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        // HOD_IT role has been removed\n"},"line_number":514,"absolute_offset":20325,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        return response()->json(['error' => 'HOD_IT role has been removed'], 404);\n"},"line_number":515,"absolute_offset":20365,"submatches":[{"match":{"text":"-"},"start":25,"end":26}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        \n"},"line_number":516,"absolute_offset":20448,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        /*\n"},"line_number":517,"absolute_offset":20457,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        return $this->processApproval($request, $id, 'hod_it', [\n"},"line_number":518,"absolute_offset":20468,"submatches":[{"match":{"text":"-"},"start":20,"end":21}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'action' => 'required|in:approve,reject',\n"},"line_number":519,"absolute_offset":20533,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'comments' => 'nullable|string|max:1000',\n"},"line_number":520,"absolute_offset":20587,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'signature' => 'required|file|mimes:png,jpg,jpeg|max:2048',\n"},"line_number":521,"absolute_offset":20641,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":528,"absolute_offset":20787,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function approveAsICTOfficer(Request $request, int $id): JsonResponse\n"},"line_number":529,"absolute_offset":20795,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":530,"absolute_offset":20876,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        return $this->processApproval($request, $id, 'ict_officer', [\n"},"line_number":531,"absolute_offset":20882,"submatches":[{"match":{"text":"-"},"start":20,"end":21}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'action' => 'required|in:approve,reject',\n"},"line_number":532,"absolute_offset":20952,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'comments' => 'nullable|string|max:1000',\n"},"line_number":533,"absolute_offset":21006,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'signature' => 'required|file|mimes:png,jpg,jpeg|max:2048',\n"},"line_number":534,"absolute_offset":21060,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    private function processApproval(Request $request, int $id, string $role, array $validationRules): JsonResponse\n"},"line_number":541,"absolute_offset":21209,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":542,"absolute_offset":21325,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":543,"absolute_offset":21331,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $user = $request->user();\n"},"line_number":544,"absolute_offset":21345,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $form = ModuleAccessRequest::bothServiceForm()->findOrFail($id);\n"},"line_number":545,"absolute_offset":21383,"submatches":[{"match":{"text":"-"},"start":58,"end":59}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":546,"absolute_offset":21460,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Check if user can approve at this stage\n"},"line_number":547,"absolute_offset":21461,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!$form->canUserApprove($user)) {\n"},"line_number":548,"absolute_offset":21516,"submatches":[{"match":{"text":"-"},"start":22,"end":23}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":549,"absolute_offset":21565,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":550,"absolute_offset":21607,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'Unauthorized to approve at this stage'\n"},"line_number":551,"absolute_offset":21647,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":552,"absolute_offset":21720,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":553,"absolute_offset":21745,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":554,"absolute_offset":21759,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $validated = $request->validate($validationRules);\n"},"line_number":555,"absolute_offset":21760,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":556,"absolute_offset":21823,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            DB::beginTransaction();\n"},"line_number":557,"absolute_offset":21824,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":558,"absolute_offset":21860,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Handle signature upload\n"},"line_number":559,"absolute_offset":21861,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $signaturePath = null;\n"},"line_number":560,"absolute_offset":21900,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if ($request->hasFile('signature')) {\n"},"line_number":561,"absolute_offset":21935,"submatches":[{"match":{"text":"-"},"start":24,"end":25}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $signaturePath = $request->file('signature')->store(\"signatures/both-service-forms/{$role}\", 'public');\n"},"line_number":562,"absolute_offset":21985,"submatches":[{"match":{"text":"-"},"start":41,"end":42},{"match":{"text":"-"},"start":60,"end":61},{"match":{"text":"-"},"start":84,"end":85},{"match":{"text":"-"},"start":92,"end":93}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":563,"absolute_offset":22105,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":564,"absolute_offset":22119,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Update approval fields based on role\n"},"line_number":565,"absolute_offset":22120,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $approvalStatus = $validated['action'] === 'approve' ? ModuleAccessRequest::STATUS_APPROVED : ModuleAccessRequest::STATUS_REJECTED;\n"},"line_number":566,"absolute_offset":22172,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":567,"absolute_offset":22316,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $form->update([\n"},"line_number":568,"absolute_offset":22329,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                \"{$role}_approval_status\" => $approvalStatus,\n"},"line_number":569,"absolute_offset":22357,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                \"{$role}_comments\" => $validated['comments'] ?? null,\n"},"line_number":570,"absolute_offset":22419,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                \"{$role}_signature_path\" => $signaturePath,\n"},"line_number":571,"absolute_offset":22489,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                \"{$role}_approved_at\" => now(),\n"},"line_number":572,"absolute_offset":22549,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                \"{$role}_user_id\" => $user->id,\n"},"line_number":573,"absolute_offset":22597,"submatches":[{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":574,"absolute_offset":22645,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":575,"absolute_offset":22661,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if ($validated['action'] === 'approve') {\n"},"line_number":576,"absolute_offset":22662,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $form->moveToNextStage();\n"},"line_number":577,"absolute_offset":22716,"submatches":[{"match":{"text":"-"},"start":21,"end":22}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            } else {\n"},"line_number":578,"absolute_offset":22758,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $form->rejectRequest();\n"},"line_number":579,"absolute_offset":22779,"submatches":[{"match":{"text":"-"},"start":21,"end":22}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":580,"absolute_offset":22819,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":581,"absolute_offset":22833,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $form->save();\n"},"line_number":582,"absolute_offset":22834,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":583,"absolute_offset":22861,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            DB::commit();\n"},"line_number":584,"absolute_offset":22862,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":585,"absolute_offset":22888,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::info(\"Both-service-form {$validated['action']}d by {$role}\", [\n"},"line_number":586,"absolute_offset":22889,"submatches":[{"match":{"text":"-"},"start":27,"end":28},{"match":{"text":"-"},"start":35,"end":36}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'form_id' => $form->id,\n"},"line_number":587,"absolute_offset":22969,"submatches":[{"match":{"text":"-"},"start":34,"end":35}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $user->id,\n"},"line_number":588,"absolute_offset":23009,"submatches":[{"match":{"text":"-"},"start":34,"end":35}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'role' => $role,\n"},"line_number":589,"absolute_offset":23049,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'action' => $validated['action']\n"},"line_number":590,"absolute_offset":23082,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":591,"absolute_offset":23131,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":592,"absolute_offset":23147,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":593,"absolute_offset":23148,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":594,"absolute_offset":23186,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => \"Form {$validated['action']}d successfully\",\n"},"line_number":595,"absolute_offset":23221,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $form->fresh(['user', 'department', 'hodUser', 'divisionalDirectorUser', 'dictUser', 'hodItUser', 'ictOfficerUser'])\n"},"line_number":596,"absolute_offset":23295,"submatches":[{"match":{"text":"-"},"start":31,"end":32}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":597,"absolute_offset":23438,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":598,"absolute_offset":23454,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (ValidationException $e) {\n"},"line_number":599,"absolute_offset":23455,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            DB::rollBack();\n"},"line_number":600,"absolute_offset":23498,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":601,"absolute_offset":23526,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":602,"absolute_offset":23564,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Validation failed',\n"},"line_number":603,"absolute_offset":23600,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'errors' => $e->errors()\n"},"line_number":604,"absolute_offset":23650,"submatches":[{"match":{"text":"-"},"start":30,"end":31}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 422);\n"},"line_number":605,"absolute_offset":23691,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":606,"absolute_offset":23712,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            DB::rollBack();\n"},"line_number":607,"absolute_offset":23746,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error(\"Error processing {$role} approval\", [\n"},"line_number":608,"absolute_offset":23774,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":609,"absolute_offset":23836,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'form_id' => $id,\n"},"line_number":610,"absolute_offset":23881,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $request->user()?->id\n"},"line_number":611,"absolute_offset":23915,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":612,"absolute_offset":23966,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":613,"absolute_offset":23982,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":614,"absolute_offset":23983,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":615,"absolute_offset":24021,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to process approval'\n"},"line_number":616,"absolute_offset":24057,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":617,"absolute_offset":24115,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":623,"absolute_offset":24200,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    private function canUserViewForm(User $user, ModuleAccessRequest $form): bool\n"},"line_number":624,"absolute_offset":24208,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":625,"absolute_offset":24290,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $userRole = $user->role?->name;\n"},"line_number":626,"absolute_offset":24296,"submatches":[{"match":{"text":"-"},"start":25,"end":26},{"match":{"text":"-"},"start":32,"end":33}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":627,"absolute_offset":24336,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        // Form owner can always view\n"},"line_number":628,"absolute_offset":24337,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->user_id === $user->id) {\n"},"line_number":629,"absolute_offset":24375,"submatches":[{"match":{"text":"-"},"start":17,"end":18},{"match":{"text":"-"},"start":36,"end":37}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return true;\n"},"line_number":630,"absolute_offset":24419,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":631,"absolute_offset":24444,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":632,"absolute_offset":24454,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        // HOD can view forms from their department\n"},"line_number":633,"absolute_offset":24455,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if (in_array($userRole, ['head_of_department'])) {\n"},"line_number":634,"absolute_offset":24507,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return $form->department && $form->department->hod_user_id === $user->id;\n"},"line_number":635,"absolute_offset":24566,"submatches":[{"match":{"text":"-"},"start":24,"end":25},{"match":{"text":"-"},"start":45,"end":46},{"match":{"text":"-"},"start":57,"end":58},{"match":{"text":"-"},"start":80,"end":81}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":636,"absolute_offset":24652,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":637,"absolute_offset":24662,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        // Other approvers can view forms in their approval stage or completed forms\n"},"line_number":638,"absolute_offset":24663,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":653,"absolute_offset":25108,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    private function getUserPermissions(User $user, ModuleAccessRequest $form): array\n"},"line_number":654,"absolute_offset":25116,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":655,"absolute_offset":25202,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $userRole = $user->role?->name;\n"},"line_number":656,"absolute_offset":25208,"submatches":[{"match":{"text":"-"},"start":25,"end":26},{"match":{"text":"-"},"start":32,"end":33}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $canApprove = $form->canUserApprove($user);\n"},"line_number":657,"absolute_offset":25248,"submatches":[{"match":{"text":"-"},"start":27,"end":28}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":658,"absolute_offset":25300,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        return [\n"},"line_number":659,"absolute_offset":25301,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'can_edit_personal_info' => false, // Personal info is auto-populated\n"},"line_number":660,"absolute_offset":25318,"submatches":[{"match":{"text":"-"},"start":71,"end":72}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'can_edit_services' => $form->user_id === $user->id && $form->overall_status === ModuleAccessRequest::STATUS_PENDING,\n"},"line_number":661,"absolute_offset":25400,"submatches":[{"match":{"text":"-"},"start":40,"end":41},{"match":{"text":"-"},"start":59,"end":60},{"match":{"text":"-"},"start":72,"end":73}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'can_approve' => $canApprove,\n"},"line_number":662,"absolute_offset":25530,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'approval_stage' => $form->current_approval_stage,\n"},"line_number":663,"absolute_offset":25572,"submatches":[{"match":{"text":"-"},"start":37,"end":38}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'user_role' => $userRole,\n"},"line_number":664,"absolute_offset":25635,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'readonly_sections' => $this->getReadonlySections($user, $form),\n"},"line_number":665,"absolute_offset":25673,"submatches":[{"match":{"text":"-"},"start":40,"end":41}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        ];\n"},"line_number":666,"absolute_offset":25750,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    }\n"},"line_number":667,"absolute_offset":25761,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":668,"absolute_offset":25767,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":671,"absolute_offset":25824,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    private function getReadonlySections(User $user, ModuleAccessRequest $form): array\n"},"line_number":672,"absolute_offset":25832,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":673,"absolute_offset":25919,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $userRole = $user->role?->name;\n"},"line_number":674,"absolute_offset":25925,"submatches":[{"match":{"text":"-"},"start":25,"end":26},{"match":{"text":"-"},"start":32,"end":33}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $currentStage = $form->current_approval_stage;\n"},"line_number":675,"absolute_offset":25965,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        \n"},"line_number":676,"absolute_offset":26020,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $allSections = ['hod', 'divisional_director', 'dict', 'ict_officer'];\n"},"line_number":677,"absolute_offset":26029,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $readonlySections = [];\n"},"line_number":678,"absolute_offset":26107,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $canEditSection = false;\n"},"line_number":681,"absolute_offset":26185,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":682,"absolute_offset":26222,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // User can edit their own approval section if it's the current stage\n"},"line_number":683,"absolute_offset":26223,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if ($currentStage === $section && $form->canUserApprove($user)) {\n"},"line_number":684,"absolute_offset":26305,"submatches":[{"match":{"text":"-"},"start":51,"end":52}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $canEditSection = true;\n"},"line_number":685,"absolute_offset":26383,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":686,"absolute_offset":26423,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":687,"absolute_offset":26437,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    }\n"},"line_number":694,"absolute_offset":26581,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":695,"absolute_offset":26587,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    /**\n"},"line_number":696,"absolute_offset":26588,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     * Get both-service-form data with specific columns for table display\n"},"line_number":697,"absolute_offset":26596,"submatches":[{"match":{"text":"-"},"start":15,"end":16},{"match":{"text":"-"},"start":23,"end":24}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":698,"absolute_offset":26670,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function getTableData(Request $request): JsonResponse\n"},"line_number":699,"absolute_offset":26678,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":700,"absolute_offset":26743,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":701,"absolute_offset":26749,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $user = $request->user();\n"},"line_number":702,"absolute_offset":26763,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userRole = $user->role?->name;\n"},"line_number":703,"absolute_offset":26801,"submatches":[{"match":{"text":"-"},"start":29,"end":30},{"match":{"text":"-"},"start":36,"end":37}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":704,"absolute_offset":26845,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!$userRole) {\n"},"line_number":705,"absolute_offset":26846,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":706,"absolute_offset":26876,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":707,"absolute_offset":26918,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'User role not found'\n"},"line_number":708,"absolute_offset":26958,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":709,"absolute_offset":27013,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":710,"absolute_offset":27038,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":711,"absolute_offset":27052,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $query = ModuleAccessRequest::bothServiceForm()\n"},"line_number":712,"absolute_offset":27053,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->with(['user', 'department', 'hodUser', 'divisionalDirectorUser', 'dictUser', 'hodItUser', 'ictOfficerUser']);\n"},"line_number":713,"absolute_offset":27113,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":714,"absolute_offset":27241,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Filter based on user role\n"},"line_number":715,"absolute_offset":27242,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (in_array($userRole, ['head_of_department'])) {\n"},"line_number":716,"absolute_offset":27283,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                // HOD can see forms from their department\n"},"line_number":717,"absolute_offset":27346,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $query->whereHas('department', function ($q) use ($user) {\n"},"line_number":718,"absolute_offset":27405,"submatches":[{"match":{"text":"-"},"start":22,"end":23}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    $q->where('hod_user_id', $user->id);\n"},"line_number":719,"absolute_offset":27480,"submatches":[{"match":{"text":"-"},"start":22,"end":23},{"match":{"text":"-"},"start":50,"end":51}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                });\n"},"line_number":720,"absolute_offset":27537,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            } elseif (in_array($userRole, ['divisional_director', 'ict_director', 'ict_officer'])) {\n"},"line_number":721,"absolute_offset":27557,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                // Other approvers can see forms in their approval stage\n"},"line_number":722,"absolute_offset":27658,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $query->forRole($userRole);\n"},"line_number":723,"absolute_offset":27731,"submatches":[{"match":{"text":"-"},"start":22,"end":23}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            } else {\n"},"line_number":724,"absolute_offset":27775,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                // Regular users can only see their own forms\n"},"line_number":725,"absolute_offset":27796,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $query->where('user_id', $user->id);\n"},"line_number":726,"absolute_offset":27858,"submatches":[{"match":{"text":"-"},"start":22,"end":23},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":727,"absolute_offset":27911,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":728,"absolute_offset":27925,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $forms = $query->orderBy('created_at', 'desc')->get();\n"},"line_number":729,"absolute_offset":27926,"submatches":[{"match":{"text":"-"},"start":27,"end":28},{"match":{"text":"-"},"start":58,"end":59}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":730,"absolute_offset":27993,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Transform data to match the requested columns\n"},"line_number":731,"absolute_offset":27994,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $tableData = $forms->map(function ($form) use ($user) {\n"},"line_number":732,"absolute_offset":28055,"submatches":[{"match":{"text":"-"},"start":31,"end":32}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return [\n"},"line_number":733,"absolute_offset":28123,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'request_id' => $form->id,\n"},"line_number":734,"absolute_offset":28148,"submatches":[{"match":{"text":"-"},"start":41,"end":42}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'request_type' => $this->getRequestTypeDisplay($form->services_requested),\n"},"line_number":735,"absolute_offset":28195,"submatches":[{"match":{"text":"-"},"start":43,"end":44},{"match":{"text":"-"},"start":72,"end":73}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'personal_information' => [\n"},"line_number":736,"absolute_offset":28290,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'pf_number' => $form->pf_number,\n"},"line_number":737,"absolute_offset":28338,"submatches":[{"match":{"text":"-"},"start":44,"end":45}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'staff_name' => $form->staff_name,\n"},"line_number":738,"absolute_offset":28395,"submatches":[{"match":{"text":"-"},"start":45,"end":46}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'phone_number' => $form->phone_number,\n"},"line_number":739,"absolute_offset":28454,"submatches":[{"match":{"text":"-"},"start":47,"end":48}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'department' => $form->department?->name ?? 'N/A'\n"},"line_number":740,"absolute_offset":28517,"submatches":[{"match":{"text":"-"},"start":45,"end":46},{"match":{"text":"-"},"start":58,"end":59}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ],\n"},"line_number":741,"absolute_offset":28591,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'module_requested_for' => $this->getModuleRequestedFor($form),\n"},"line_number":742,"absolute_offset":28614,"submatches":[{"match":{"text":"-"},"start":51,"end":52}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'module_request' => $form->modules ?? [],\n"},"line_number":743,"absolute_offset":28697,"submatches":[{"match":{"text":"-"},"start":45,"end":46}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'access_rights' => ucfirst($form->access_type),\n"},"line_number":744,"absolute_offset":28759,"submatches":[{"match":{"text":"-"},"start":52,"end":53}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approval' => $this->getApprovalStatus($form),\n"},"line_number":745,"absolute_offset":28827,"submatches":[{"match":{"text":"-"},"start":39,"end":40}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'comments' => $this->getAllComments($form),\n"},"line_number":746,"absolute_offset":28894,"submatches":[{"match":{"text":"-"},"start":39,"end":40}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'for_implementation' => $this->getImplementationStatus($form),\n"},"line_number":747,"absolute_offset":28958,"submatches":[{"match":{"text":"-"},"start":49,"end":50}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'submission_date' => $form->created_at->format('Y-m-d H:i:s'),\n"},"line_number":748,"absolute_offset":29041,"submatches":[{"match":{"text":"-"},"start":46,"end":47},{"match":{"text":"-"},"start":58,"end":59},{"match":{"text":"-"},"start":69,"end":70},{"match":{"text":"-"},"start":71,"end":72}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'current_status' => $this->getCurrentStatusDisplay($form),\n"},"line_number":749,"absolute_offset":29124,"submatches":[{"match":{"text":"-"},"start":45,"end":46}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'actions' => $this->getAvailableActions($form, $user)\n"},"line_number":750,"absolute_offset":29203,"submatches":[{"match":{"text":"-"},"start":38,"end":39}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ];\n"},"line_number":751,"absolute_offset":29277,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            });\n"},"line_number":752,"absolute_offset":29296,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":753,"absolute_offset":29312,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":754,"absolute_offset":29313,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":755,"absolute_offset":29351,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $tableData\n"},"line_number":756,"absolute_offset":29386,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":757,"absolute_offset":29423,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":758,"absolute_offset":29439,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":759,"absolute_offset":29440,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error getting both-service-form table data', [\n"},"line_number":760,"absolute_offset":29474,"submatches":[{"match":{"text":"-"},"start":42,"end":43},{"match":{"text":"-"},"start":50,"end":51}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":761,"absolute_offset":29545,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $request->user()?->id\n"},"line_number":762,"absolute_offset":29590,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":763,"absolute_offset":29641,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":764,"absolute_offset":29657,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":765,"absolute_offset":29658,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":766,"absolute_offset":29696,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to get table data'\n"},"line_number":767,"absolute_offset":29732,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":768,"absolute_offset":29788,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function getFormForHOD(Request $request, int $id): JsonResponse\n"},"line_number":775,"absolute_offset":29885,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":776,"absolute_offset":29960,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":777,"absolute_offset":29966,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $user = $request->user();\n"},"line_number":778,"absolute_offset":29980,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userRole = $user->role?->name;\n"},"line_number":779,"absolute_offset":30018,"submatches":[{"match":{"text":"-"},"start":29,"end":30},{"match":{"text":"-"},"start":36,"end":37}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":780,"absolute_offset":30062,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Check if user is HOD\n"},"line_number":781,"absolute_offset":30063,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!in_array($userRole, ['head_of_department'])) {\n"},"line_number":782,"absolute_offset":30099,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":783,"absolute_offset":30163,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":784,"absolute_offset":30205,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'Access denied. Only HOD can access this endpoint.'\n"},"line_number":785,"absolute_offset":30245,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":786,"absolute_offset":30330,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":787,"absolute_offset":30355,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":788,"absolute_offset":30369,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $form = ModuleAccessRequest::bothServiceForm()\n"},"line_number":789,"absolute_offset":30370,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->with(['user', 'department', 'hodUser', 'divisionalDirectorUser', 'dictUser', 'hodItUser', 'ictOfficerUser'])\n"},"line_number":790,"absolute_offset":30429,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->findOrFail($id);\n"},"line_number":791,"absolute_offset":30556,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":792,"absolute_offset":30591,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Check if HOD can view this form (from their department)\n"},"line_number":793,"absolute_offset":30592,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!$this->canUserViewForm($user, $form)) {\n"},"line_number":794,"absolute_offset":30663,"submatches":[{"match":{"text":"-"},"start":22,"end":23}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":795,"absolute_offset":30720,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":796,"absolute_offset":30762,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'Unauthorized to view this form'\n"},"line_number":797,"absolute_offset":30802,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":798,"absolute_offset":30868,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":799,"absolute_offset":30893,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":800,"absolute_offset":30907,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Prepare form data with HOD-specific permissions\n"},"line_number":801,"absolute_offset":30908,"submatches":[{"match":{"text":"-"},"start":41,"end":42}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $formData = [\n"},"line_number":802,"absolute_offset":30971,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'id' => $form->id,\n"},"line_number":803,"absolute_offset":30997,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'request_id' => $form->id,\n"},"line_number":804,"absolute_offset":31032,"submatches":[{"match":{"text":"-"},"start":37,"end":38}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'personal_information' => [\n"},"line_number":805,"absolute_offset":31075,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'pf_number' => $form->pf_number,\n"},"line_number":806,"absolute_offset":31119,"submatches":[{"match":{"text":"-"},"start":40,"end":41}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'staff_name' => $form->staff_name,\n"},"line_number":807,"absolute_offset":31172,"submatches":[{"match":{"text":"-"},"start":41,"end":42}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'phone_number' => $form->phone_number,\n"},"line_number":808,"absolute_offset":31227,"submatches":[{"match":{"text":"-"},"start":43,"end":44}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'department' => $form->department?->name ?? 'N/A',\n"},"line_number":809,"absolute_offset":31286,"submatches":[{"match":{"text":"-"},"start":41,"end":42},{"match":{"text":"-"},"start":54,"end":55}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'department_id' => $form->department_id\n"},"line_number":810,"absolute_offset":31357,"submatches":[{"match":{"text":"-"},"start":44,"end":45}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ],\n"},"line_number":811,"absolute_offset":31417,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'services_requested' => $form->services_requested,\n"},"line_number":812,"absolute_offset":31436,"submatches":[{"match":{"text":"-"},"start":45,"end":46}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'access_type' => $form->access_type,\n"},"line_number":813,"absolute_offset":31503,"submatches":[{"match":{"text":"-"},"start":38,"end":39}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'temporary_until' => $form->temporary_until,\n"},"line_number":814,"absolute_offset":31556,"submatches":[{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'modules' => $form->modules,\n"},"line_number":815,"absolute_offset":31617,"submatches":[{"match":{"text":"-"},"start":34,"end":35}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'comments' => $form->comments,\n"},"line_number":816,"absolute_offset":31662,"submatches":[{"match":{"text":"-"},"start":35,"end":36}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'signature_path' => $form->signature_path,\n"},"line_number":817,"absolute_offset":31709,"submatches":[{"match":{"text":"-"},"start":41,"end":42}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'overall_status' => $form->overall_status,\n"},"line_number":818,"absolute_offset":31768,"submatches":[{"match":{"text":"-"},"start":41,"end":42}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'current_approval_stage' => $form->current_approval_stage,\n"},"line_number":819,"absolute_offset":31827,"submatches":[{"match":{"text":"-"},"start":49,"end":50}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'created_at' => $form->created_at,\n"},"line_number":820,"absolute_offset":31902,"submatches":[{"match":{"text":"-"},"start":37,"end":38}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                \n"},"line_number":821,"absolute_offset":31953,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                // HOD Approval Section\n"},"line_number":822,"absolute_offset":31970,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'hod_section' => [\n"},"line_number":823,"absolute_offset":32010,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approval_status' => $form->hod_approval_status,\n"},"line_number":824,"absolute_offset":32045,"submatches":[{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'comments' => $form->hod_comments,\n"},"line_number":825,"absolute_offset":32114,"submatches":[{"match":{"text":"-"},"start":39,"end":40}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'signature_path' => $form->hod_signature_path,\n"},"line_number":826,"absolute_offset":32169,"submatches":[{"match":{"text":"-"},"start":45,"end":46}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approved_at' => $form->hod_approved_at,\n"},"line_number":827,"absolute_offset":32236,"submatches":[{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approved_by' => $form->hodUser?->name,\n"},"line_number":828,"absolute_offset":32297,"submatches":[{"match":{"text":"-"},"start":42,"end":43},{"match":{"text":"-"},"start":52,"end":53}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'can_edit' => $form->canUserApprove($user) && $form->current_approval_stage === 'hod',\n"},"line_number":829,"absolute_offset":32357,"submatches":[{"match":{"text":"-"},"start":39,"end":40},{"match":{"text":"-"},"start":71,"end":72}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'is_required' => true\n"},"line_number":830,"absolute_offset":32464,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ],\n"},"line_number":831,"absolute_offset":32506,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                \n"},"line_number":832,"absolute_offset":32525,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                // Other sections (readonly for HOD)\n"},"line_number":833,"absolute_offset":32542,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'divisional_director_section' => [\n"},"line_number":834,"absolute_offset":32595,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approval_status' => $form->divisional_director_approval_status,\n"},"line_number":835,"absolute_offset":32646,"submatches":[{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'comments' => $form->divisional_director_comments,\n"},"line_number":836,"absolute_offset":32731,"submatches":[{"match":{"text":"-"},"start":39,"end":40}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approved_at' => $form->divisional_director_approved_at,\n"},"line_number":837,"absolute_offset":32802,"submatches":[{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approved_by' => $form->divisionalDirectorUser?->name,\n"},"line_number":838,"absolute_offset":32879,"submatches":[{"match":{"text":"-"},"start":42,"end":43},{"match":{"text":"-"},"start":67,"end":68}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'can_edit' => false,\n"},"line_number":839,"absolute_offset":32954,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'is_readonly' => true\n"},"line_number":840,"absolute_offset":32995,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ],\n"},"line_number":841,"absolute_offset":33037,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'dict_section' => [\n"},"line_number":842,"absolute_offset":33056,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approval_status' => $form->dict_approval_status,\n"},"line_number":843,"absolute_offset":33092,"submatches":[{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'comments' => $form->dict_comments,\n"},"line_number":844,"absolute_offset":33162,"submatches":[{"match":{"text":"-"},"start":39,"end":40}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approved_at' => $form->dict_approved_at,\n"},"line_number":845,"absolute_offset":33218,"submatches":[{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approved_by' => $form->dictUser?->name,\n"},"line_number":846,"absolute_offset":33280,"submatches":[{"match":{"text":"-"},"start":42,"end":43},{"match":{"text":"-"},"start":53,"end":54}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'can_edit' => false,\n"},"line_number":847,"absolute_offset":33341,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'is_readonly' => true\n"},"line_number":848,"absolute_offset":33382,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ],\n"},"line_number":849,"absolute_offset":33424,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'ict_officer_section' => [\n"},"line_number":850,"absolute_offset":33443,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approval_status' => $form->ict_officer_approval_status,\n"},"line_number":851,"absolute_offset":33486,"submatches":[{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'comments' => $form->ict_officer_comments,\n"},"line_number":852,"absolute_offset":33563,"submatches":[{"match":{"text":"-"},"start":39,"end":40}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approved_at' => $form->ict_officer_approved_at,\n"},"line_number":853,"absolute_offset":33626,"submatches":[{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'approved_by' => $form->ictOfficerUser?->name,\n"},"line_number":854,"absolute_offset":33695,"submatches":[{"match":{"text":"-"},"start":42,"end":43},{"match":{"text":"-"},"start":59,"end":60}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'can_edit' => false,\n"},"line_number":855,"absolute_offset":33762,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'is_readonly' => true\n"},"line_number":856,"absolute_offset":33803,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ],\n"},"line_number":857,"absolute_offset":33845,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                \n"},"line_number":858,"absolute_offset":33864,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                // User permissions\n"},"line_number":859,"absolute_offset":33881,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_permissions' => [\n"},"line_number":860,"absolute_offset":33917,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'can_approve' => $form->canUserApprove($user),\n"},"line_number":861,"absolute_offset":33957,"submatches":[{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'can_reject' => $form->canUserApprove($user),\n"},"line_number":862,"absolute_offset":34024,"submatches":[{"match":{"text":"-"},"start":41,"end":42}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'current_user_role' => $userRole,\n"},"line_number":863,"absolute_offset":34090,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'is_hod' => true,\n"},"line_number":864,"absolute_offset":34144,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'can_submit_to_next_stage' => $form->canUserApprove($user) && $form->current_approval_stage === 'hod'\n"},"line_number":865,"absolute_offset":34182,"submatches":[{"match":{"text":"-"},"start":55,"end":56},{"match":{"text":"-"},"start":87,"end":88}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ]\n"},"line_number":866,"absolute_offset":34304,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ];\n"},"line_number":867,"absolute_offset":34322,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":868,"absolute_offset":34337,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":869,"absolute_offset":34338,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":870,"absolute_offset":34376,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => $formData\n"},"line_number":871,"absolute_offset":34411,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":872,"absolute_offset":34447,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":873,"absolute_offset":34463,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":874,"absolute_offset":34464,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error getting form for HOD', [\n"},"line_number":875,"absolute_offset":34498,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":876,"absolute_offset":34553,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'form_id' => $id,\n"},"line_number":877,"absolute_offset":34598,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $request->user()?->id\n"},"line_number":878,"absolute_offset":34632,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":879,"absolute_offset":34683,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":880,"absolute_offset":34699,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":881,"absolute_offset":34700,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":882,"absolute_offset":34738,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to get form'\n"},"line_number":883,"absolute_offset":34774,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":884,"absolute_offset":34824,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function hodSubmitToNextStage(Request $request, int $id): JsonResponse\n"},"line_number":891,"absolute_offset":34910,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":892,"absolute_offset":34992,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":893,"absolute_offset":34998,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $user = $request->user();\n"},"line_number":894,"absolute_offset":35012,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $userRole = $user->role?->name;\n"},"line_number":895,"absolute_offset":35050,"submatches":[{"match":{"text":"-"},"start":29,"end":30},{"match":{"text":"-"},"start":36,"end":37}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":896,"absolute_offset":35094,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Check if user is HOD\n"},"line_number":897,"absolute_offset":35095,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!in_array($userRole, ['head_of_department'])) {\n"},"line_number":898,"absolute_offset":35131,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":899,"absolute_offset":35195,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":900,"absolute_offset":35237,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'Access denied. Only HOD can submit to next stage.'\n"},"line_number":901,"absolute_offset":35277,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":902,"absolute_offset":35362,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":903,"absolute_offset":35387,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":904,"absolute_offset":35401,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $form = ModuleAccessRequest::bothServiceForm()->findOrFail($id);\n"},"line_number":905,"absolute_offset":35402,"submatches":[{"match":{"text":"-"},"start":58,"end":59}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":906,"absolute_offset":35479,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Check if HOD can approve this form\n"},"line_number":907,"absolute_offset":35480,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!$form->canUserApprove($user) || $form->current_approval_stage !== 'hod') {\n"},"line_number":908,"absolute_offset":35530,"submatches":[{"match":{"text":"-"},"start":22,"end":23},{"match":{"text":"-"},"start":54,"end":55}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":909,"absolute_offset":35622,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":910,"absolute_offset":35664,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'Cannot submit to next stage. Form is not in HOD approval stage or you are not authorized.'\n"},"line_number":911,"absolute_offset":35704,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":912,"absolute_offset":35829,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":913,"absolute_offset":35854,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":914,"absolute_offset":35868,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Validate HOD input\n"},"line_number":915,"absolute_offset":35869,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $validated = $request->validate([\n"},"line_number":916,"absolute_offset":35903,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'action' => 'required|in:approve,reject',\n"},"line_number":917,"absolute_offset":35949,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'comments' => 'required|string|min:10|max:1000', // HOD comments are required\n"},"line_number":918,"absolute_offset":36007,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'signature' => 'required|file|mimes:png,jpg,jpeg|max:2048',\n"},"line_number":919,"absolute_offset":36101,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":923,"absolute_offset":36230,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Handle signature upload\n"},"line_number":924,"absolute_offset":36231,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $signaturePath = null;\n"},"line_number":925,"absolute_offset":36270,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if ($request->hasFile('signature')) {\n"},"line_number":926,"absolute_offset":36305,"submatches":[{"match":{"text":"-"},"start":24,"end":25}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $signaturePath = $request->file('signature')->store('signatures/both-service-forms/hod', 'public');\n"},"line_number":927,"absolute_offset":36355,"submatches":[{"match":{"text":"-"},"start":41,"end":42},{"match":{"text":"-"},"start":60,"end":61},{"match":{"text":"-"},"start":84,"end":85},{"match":{"text":"-"},"start":92,"end":93}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":928,"absolute_offset":36471,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":929,"absolute_offset":36485,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Update HOD approval\n"},"line_number":930,"absolute_offset":36486,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $approvalStatus = $validated['action'] === 'approve' ? ModuleAccessRequest::STATUS_APPROVED : ModuleAccessRequest::STATUS_REJECTED;\n"},"line_number":931,"absolute_offset":36521,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":932,"absolute_offset":36665,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $form->update([\n"},"line_number":933,"absolute_offset":36678,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'hod_approval_status' => $approvalStatus,\n"},"line_number":934,"absolute_offset":36706,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'hod_comments' => $validated['comments'],\n"},"line_number":935,"absolute_offset":36764,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'hod_signature_path' => $signaturePath,\n"},"line_number":936,"absolute_offset":36822,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'hod_approved_at' => now(),\n"},"line_number":937,"absolute_offset":36878,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'hod_user_id' => $user->id,\n"},"line_number":938,"absolute_offset":36922,"submatches":[{"match":{"text":"-"},"start":38,"end":39}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":939,"absolute_offset":36966,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":940,"absolute_offset":36982,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if ($validated['action'] === 'approve') {\n"},"line_number":941,"absolute_offset":36983,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $form->moveToNextStage();\n"},"line_number":942,"absolute_offset":37037,"submatches":[{"match":{"text":"-"},"start":21,"end":22}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $message = 'Form approved and submitted to Divisional Director';\n"},"line_number":943,"absolute_offset":37079,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            } else {\n"},"line_number":944,"absolute_offset":37160,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $form->rejectRequest();\n"},"line_number":945,"absolute_offset":37181,"submatches":[{"match":{"text":"-"},"start":21,"end":22}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $message = 'Form rejected';\n"},"line_number":946,"absolute_offset":37221,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":947,"absolute_offset":37265,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":948,"absolute_offset":37279,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $form->save();\n"},"line_number":949,"absolute_offset":37280,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":950,"absolute_offset":37307,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            DB::commit();\n"},"line_number":951,"absolute_offset":37308,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":952,"absolute_offset":37334,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::info(\"HOD {$validated['action']}d both-service-form\", [\n"},"line_number":953,"absolute_offset":37335,"submatches":[{"match":{"text":"-"},"start":55,"end":56},{"match":{"text":"-"},"start":63,"end":64}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'form_id' => $form->id,\n"},"line_number":954,"absolute_offset":37408,"submatches":[{"match":{"text":"-"},"start":34,"end":35}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $user->id,\n"},"line_number":955,"absolute_offset":37448,"submatches":[{"match":{"text":"-"},"start":34,"end":35}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'action' => $validated['action']\n"},"line_number":956,"absolute_offset":37488,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":957,"absolute_offset":37537,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":958,"absolute_offset":37553,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":959,"absolute_offset":37554,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":960,"absolute_offset":37592,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => $message,\n"},"line_number":961,"absolute_offset":37627,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'data' => [\n"},"line_number":962,"absolute_offset":37666,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'form_id' => $form->id,\n"},"line_number":963,"absolute_offset":37694,"submatches":[{"match":{"text":"-"},"start":38,"end":39}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'overall_status' => $form->overall_status,\n"},"line_number":964,"absolute_offset":37738,"submatches":[{"match":{"text":"-"},"start":45,"end":46}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'current_approval_stage' => $form->current_approval_stage,\n"},"line_number":965,"absolute_offset":37801,"submatches":[{"match":{"text":"-"},"start":53,"end":54}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'hod_approval_status' => $form->hod_approval_status,\n"},"line_number":966,"absolute_offset":37880,"submatches":[{"match":{"text":"-"},"start":50,"end":51}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'next_stage' => $form->current_approval_stage === 'completed' ? 'Completed' : ucfirst(str_replace('_', ' ', $form->current_approval_stage))\n"},"line_number":967,"absolute_offset":37953,"submatches":[{"match":{"text":"-"},"start":41,"end":42},{"match":{"text":"-"},"start":133,"end":134}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ]\n"},"line_number":968,"absolute_offset":38113,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":969,"absolute_offset":38131,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":970,"absolute_offset":38147,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (ValidationException $e) {\n"},"line_number":971,"absolute_offset":38148,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            DB::rollBack();\n"},"line_number":972,"absolute_offset":38191,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":973,"absolute_offset":38219,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":974,"absolute_offset":38257,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Validation failed',\n"},"line_number":975,"absolute_offset":38293,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'errors' => $e->errors()\n"},"line_number":976,"absolute_offset":38343,"submatches":[{"match":{"text":"-"},"start":30,"end":31}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 422);\n"},"line_number":977,"absolute_offset":38384,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":978,"absolute_offset":38405,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            DB::rollBack();\n"},"line_number":979,"absolute_offset":38439,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error in HOD submit to next stage', [\n"},"line_number":980,"absolute_offset":38467,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":981,"absolute_offset":38529,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'form_id' => $id,\n"},"line_number":982,"absolute_offset":38574,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $request->user()?->id\n"},"line_number":983,"absolute_offset":38608,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":984,"absolute_offset":38659,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":985,"absolute_offset":38675,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":986,"absolute_offset":38676,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":987,"absolute_offset":38714,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to submit to next stage'\n"},"line_number":988,"absolute_offset":38750,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":989,"absolute_offset":38812,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":1013,"absolute_offset":39414,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $purposes = [];\n"},"line_number":1014,"absolute_offset":39420,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        \n"},"line_number":1015,"absolute_offset":39444,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->hasService('wellsoft')) {\n"},"line_number":1016,"absolute_offset":39453,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $purposes[] = 'Wellsoft System Access';\n"},"line_number":1017,"absolute_offset":39498,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1018,"absolute_offset":39550,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->hasService('jeeva')) {\n"},"line_number":1019,"absolute_offset":39560,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $purposes[] = 'Jeeva System Access';\n"},"line_number":1020,"absolute_offset":39602,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1021,"absolute_offset":39651,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->hasService('internet_access')) {\n"},"line_number":1022,"absolute_offset":39661,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $purposes[] = 'Internet Access';\n"},"line_number":1023,"absolute_offset":39713,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1024,"absolute_offset":39758,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":1025,"absolute_offset":39768,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":1033,"absolute_offset":39950,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        return [\n"},"line_number":1034,"absolute_offset":39956,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'hod' => [\n"},"line_number":1035,"absolute_offset":39973,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'status' => $form->hod_approval_status,\n"},"line_number":1036,"absolute_offset":39996,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'approved_by' => $form->hodUser?->name,\n"},"line_number":1037,"absolute_offset":40052,"submatches":[{"match":{"text":"-"},"start":38,"end":39},{"match":{"text":"-"},"start":48,"end":49}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'approved_at' => $form->hod_approved_at?->format('Y-m-d H:i:s')\n"},"line_number":1038,"absolute_offset":40108,"submatches":[{"match":{"text":"-"},"start":38,"end":39},{"match":{"text":"-"},"start":56,"end":57},{"match":{"text":"-"},"start":67,"end":68},{"match":{"text":"-"},"start":69,"end":70}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ],\n"},"line_number":1039,"absolute_offset":40188,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'divisional_director' => [\n"},"line_number":1040,"absolute_offset":40203,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'status' => $form->divisional_director_approval_status,\n"},"line_number":1041,"absolute_offset":40242,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'approved_by' => $form->divisionalDirectorUser?->name,\n"},"line_number":1042,"absolute_offset":40314,"submatches":[{"match":{"text":"-"},"start":38,"end":39},{"match":{"text":"-"},"start":63,"end":64}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'approved_at' => $form->divisional_director_approved_at?->format('Y-m-d H:i:s')\n"},"line_number":1043,"absolute_offset":40385,"submatches":[{"match":{"text":"-"},"start":38,"end":39},{"match":{"text":"-"},"start":72,"end":73},{"match":{"text":"-"},"start":83,"end":84},{"match":{"text":"-"},"start":85,"end":86}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ],\n"},"line_number":1044,"absolute_offset":40481,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'dict' => [\n"},"line_number":1045,"absolute_offset":40496,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'status' => $form->dict_approval_status,\n"},"line_number":1046,"absolute_offset":40520,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'approved_by' => $form->dictUser?->name,\n"},"line_number":1047,"absolute_offset":40577,"submatches":[{"match":{"text":"-"},"start":38,"end":39},{"match":{"text":"-"},"start":49,"end":50}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'approved_at' => $form->dict_approved_at?->format('Y-m-d H:i:s')\n"},"line_number":1048,"absolute_offset":40634,"submatches":[{"match":{"text":"-"},"start":38,"end":39},{"match":{"text":"-"},"start":57,"end":58},{"match":{"text":"-"},"start":68,"end":69},{"match":{"text":"-"},"start":70,"end":71}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ],\n"},"line_number":1049,"absolute_offset":40715,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":1050,"absolute_offset":40730,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            'ict_officer' => [\n"},"line_number":1051,"absolute_offset":40731,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'status' => $form->ict_officer_approval_status,\n"},"line_number":1052,"absolute_offset":40762,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'approved_by' => $form->ictOfficerUser?->name,\n"},"line_number":1053,"absolute_offset":40826,"submatches":[{"match":{"text":"-"},"start":38,"end":39},{"match":{"text":"-"},"start":55,"end":56}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'approved_at' => $form->ict_officer_approved_at?->format('Y-m-d H:i:s')\n"},"line_number":1054,"absolute_offset":40889,"submatches":[{"match":{"text":"-"},"start":38,"end":39},{"match":{"text":"-"},"start":64,"end":65},{"match":{"text":"-"},"start":75,"end":76},{"match":{"text":"-"},"start":77,"end":78}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]\n"},"line_number":1055,"absolute_offset":40977,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        ];\n"},"line_number":1056,"absolute_offset":40991,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    }\n"},"line_number":1057,"absolute_offset":41002,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":1063,"absolute_offset":41136,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $comments = [];\n"},"line_number":1064,"absolute_offset":41142,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        \n"},"line_number":1065,"absolute_offset":41166,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->comments) {\n"},"line_number":1066,"absolute_offset":41175,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $comments['initial'] = $form->comments;\n"},"line_number":1067,"absolute_offset":41206,"submatches":[{"match":{"text":"-"},"start":40,"end":41}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1068,"absolute_offset":41258,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->hod_comments) {\n"},"line_number":1069,"absolute_offset":41268,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $comments['hod'] = $form->hod_comments;\n"},"line_number":1070,"absolute_offset":41303,"submatches":[{"match":{"text":"-"},"start":36,"end":37}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1071,"absolute_offset":41355,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->divisional_director_comments) {\n"},"line_number":1072,"absolute_offset":41365,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $comments['divisional_director'] = $form->divisional_director_comments;\n"},"line_number":1073,"absolute_offset":41416,"submatches":[{"match":{"text":"-"},"start":52,"end":53}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1074,"absolute_offset":41500,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->dict_comments) {\n"},"line_number":1075,"absolute_offset":41510,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $comments['dict'] = $form->dict_comments;\n"},"line_number":1076,"absolute_offset":41546,"submatches":[{"match":{"text":"-"},"start":37,"end":38}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1077,"absolute_offset":41600,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":1078,"absolute_offset":41610,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->ict_officer_comments) {\n"},"line_number":1079,"absolute_offset":41611,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $comments['ict_officer'] = $form->ict_officer_comments;\n"},"line_number":1080,"absolute_offset":41654,"submatches":[{"match":{"text":"-"},"start":44,"end":45}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1081,"absolute_offset":41722,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":1082,"absolute_offset":41732,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        return $comments;\n"},"line_number":1083,"absolute_offset":41733,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":1088,"absolute_offset":41824,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    private function getImplementationStatus(ModuleAccessRequest $form): string\n"},"line_number":1089,"absolute_offset":41832,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":1090,"absolute_offset":41912,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->overall_status === 'approved' && $form->current_approval_stage === 'completed') {\n"},"line_number":1091,"absolute_offset":41918,"submatches":[{"match":{"text":"-"},"start":17,"end":18},{"match":{"text":"-"},"start":57,"end":58}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return 'Ready for Implementation';\n"},"line_number":1092,"absolute_offset":42019,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } elseif ($form->overall_status === 'rejected') {\n"},"line_number":1093,"absolute_offset":42066,"submatches":[{"match":{"text":"-"},"start":23,"end":24}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return 'Rejected - No Implementation';\n"},"line_number":1094,"absolute_offset":42124,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } elseif ($form->overall_status === 'in_review') {\n"},"line_number":1095,"absolute_offset":42175,"submatches":[{"match":{"text":"-"},"start":23,"end":24}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return 'Pending Approval';\n"},"line_number":1096,"absolute_offset":42234,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } else {\n"},"line_number":1097,"absolute_offset":42273,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return 'Awaiting Approval';\n"},"line_number":1098,"absolute_offset":42290,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"     */\n"},"line_number":1104,"absolute_offset":42406,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    private function getCurrentStatusDisplay(ModuleAccessRequest $form): string\n"},"line_number":1105,"absolute_offset":42414,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":1106,"absolute_offset":42494,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $stage = ucfirst(str_replace('_', ' ', $form->current_approval_stage));\n"},"line_number":1107,"absolute_offset":42500,"submatches":[{"match":{"text":"-"},"start":52,"end":53}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $status = ucfirst($form->overall_status);\n"},"line_number":1108,"absolute_offset":42580,"submatches":[{"match":{"text":"-"},"start":31,"end":32}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        \n"},"line_number":1109,"absolute_offset":42630,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->current_approval_stage === 'completed') {\n"},"line_number":1110,"absolute_offset":42639,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return 'Completed - ' . $status;\n"},"line_number":1111,"absolute_offset":42700,"submatches":[{"match":{"text":"-"},"start":30,"end":31}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1112,"absolute_offset":42745,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        \n"},"line_number":1113,"absolute_offset":42755,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        return \"At {$stage} - {$status}\";\n"},"line_number":1114,"absolute_offset":42764,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    }\n"},"line_number":1115,"absolute_offset":42806,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":1116,"absolute_offset":42812,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    /**\n"},"line_number":1117,"absolute_offset":42813,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":1121,"absolute_offset":42962,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        $actions = ['view'];\n"},"line_number":1122,"absolute_offset":42968,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        \n"},"line_number":1123,"absolute_offset":42997,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($form->canUserApprove($user)) {\n"},"line_number":1124,"absolute_offset":43006,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $actions[] = 'approve';\n"},"line_number":1125,"absolute_offset":43050,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $actions[] = 'reject';\n"},"line_number":1126,"absolute_offset":43086,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1127,"absolute_offset":43121,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        \n"},"line_number":1128,"absolute_offset":43131,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        if ($this->canUserViewForm($user, $form)) {\n"},"line_number":1129,"absolute_offset":43140,"submatches":[{"match":{"text":"-"},"start":17,"end":18}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $actions[] = 'export_pdf';\n"},"line_number":1130,"absolute_offset":43192,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1131,"absolute_offset":43231,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        \n"},"line_number":1132,"absolute_offset":43241,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function debugHodAssignments(Request $request): JsonResponse\n"},"line_number":1141,"absolute_offset":43358,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":1142,"absolute_offset":43430,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":1143,"absolute_offset":43436,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $user = $request->user();\n"},"line_number":1144,"absolute_offset":43450,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":1145,"absolute_offset":43488,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Get all relevant data for debugging\n"},"line_number":1146,"absolute_offset":43501,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $allUsers = User::with('role')->get();\n"},"line_number":1147,"absolute_offset":43552,"submatches":[{"match":{"text":"-"},"start":42,"end":43}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $allDepartments = Department::with('headOfDepartment.role')->get();\n"},"line_number":1148,"absolute_offset":43603,"submatches":[{"match":{"text":"-"},"start":71,"end":72}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $hodUsers = User::whereHas('role', function($query) {\n"},"line_number":1149,"absolute_offset":43683,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                $query->whereIn('name', ['head_of_department', 'hod_it', 'ict_director']);\n"},"line_number":1150,"absolute_offset":43749,"submatches":[{"match":{"text":"-"},"start":22,"end":23}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            })->with('role')->get();\n"},"line_number":1151,"absolute_offset":43840,"submatches":[{"match":{"text":"-"},"start":14,"end":15},{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":1152,"absolute_offset":43877,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $currentUserDepartment = Department::where('hod_user_id', $user->id)->first();\n"},"line_number":1153,"absolute_offset":43890,"submatches":[{"match":{"text":"-"},"start":75,"end":76},{"match":{"text":"-"},"start":80,"end":81}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            \n"},"line_number":1154,"absolute_offset":43981,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":1155,"absolute_offset":43994,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => true,\n"},"line_number":1156,"absolute_offset":44032,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'debug_info' => [\n"},"line_number":1157,"absolute_offset":44067,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'current_user' => [\n"},"line_number":1158,"absolute_offset":44101,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'id' => $user->id,\n"},"line_number":1159,"absolute_offset":44141,"submatches":[{"match":{"text":"-"},"start":37,"end":38}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'name' => $user->name,\n"},"line_number":1160,"absolute_offset":44184,"submatches":[{"match":{"text":"-"},"start":39,"end":40}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'email' => $user->email,\n"},"line_number":1161,"absolute_offset":44231,"submatches":[{"match":{"text":"-"},"start":40,"end":41}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'role' => $user->role?->name,\n"},"line_number":1162,"absolute_offset":44280,"submatches":[{"match":{"text":"-"},"start":39,"end":40},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'assigned_department' => $currentUserDepartment ? [\n"},"line_number":1163,"absolute_offset":44334,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'id' => $currentUserDepartment->id,\n"},"line_number":1164,"absolute_offset":44410,"submatches":[{"match":{"text":"-"},"start":58,"end":59}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'name' => $currentUserDepartment->name,\n"},"line_number":1165,"absolute_offset":44474,"submatches":[{"match":{"text":"-"},"start":60,"end":61}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'code' => $currentUserDepartment->code\n"},"line_number":1166,"absolute_offset":44542,"submatches":[{"match":{"text":"-"},"start":60,"end":61}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        ] : null\n"},"line_number":1167,"absolute_offset":44609,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ],\n"},"line_number":1168,"absolute_offset":44642,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'all_users' => $allUsers->map(function($u) {\n"},"line_number":1169,"absolute_offset":44665,"submatches":[{"match":{"text":"-"},"start":44,"end":45}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        return [\n"},"line_number":1170,"absolute_offset":44730,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'id' => $u->id,\n"},"line_number":1171,"absolute_offset":44763,"submatches":[{"match":{"text":"-"},"start":38,"end":39}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'name' => $u->name,\n"},"line_number":1172,"absolute_offset":44807,"submatches":[{"match":{"text":"-"},"start":40,"end":41}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'email' => $u->email,\n"},"line_number":1173,"absolute_offset":44855,"submatches":[{"match":{"text":"-"},"start":41,"end":42}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'role' => $u->role?->name\n"},"line_number":1174,"absolute_offset":44905,"submatches":[{"match":{"text":"-"},"start":40,"end":41},{"match":{"text":"-"},"start":47,"end":48}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        ];\n"},"line_number":1175,"absolute_offset":44959,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    }),\n"},"line_number":1176,"absolute_offset":44986,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'all_departments' => $allDepartments->map(function($dept) {\n"},"line_number":1177,"absolute_offset":45010,"submatches":[{"match":{"text":"-"},"start":56,"end":57}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        return [\n"},"line_number":1178,"absolute_offset":45090,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'id' => $dept->id,\n"},"line_number":1179,"absolute_offset":45123,"submatches":[{"match":{"text":"-"},"start":41,"end":42}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'name' => $dept->name,\n"},"line_number":1180,"absolute_offset":45170,"submatches":[{"match":{"text":"-"},"start":43,"end":44}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'code' => $dept->code,\n"},"line_number":1181,"absolute_offset":45221,"submatches":[{"match":{"text":"-"},"start":43,"end":44}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'hod_user_id' => $dept->hod_user_id,\n"},"line_number":1182,"absolute_offset":45272,"submatches":[{"match":{"text":"-"},"start":50,"end":51}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'hod_user' => $dept->headOfDepartment ? [\n"},"line_number":1183,"absolute_offset":45337,"submatches":[{"match":{"text":"-"},"start":47,"end":48}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                                'id' => $dept->headOfDepartment->id,\n"},"line_number":1184,"absolute_offset":45407,"submatches":[{"match":{"text":"-"},"start":45,"end":46},{"match":{"text":"-"},"start":63,"end":64}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                                'name' => $dept->headOfDepartment->name,\n"},"line_number":1185,"absolute_offset":45476,"submatches":[{"match":{"text":"-"},"start":47,"end":48},{"match":{"text":"-"},"start":65,"end":66}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                                'email' => $dept->headOfDepartment->email,\n"},"line_number":1186,"absolute_offset":45549,"submatches":[{"match":{"text":"-"},"start":48,"end":49},{"match":{"text":"-"},"start":66,"end":67}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                                'role' => $dept->headOfDepartment->role?->name\n"},"line_number":1187,"absolute_offset":45624,"submatches":[{"match":{"text":"-"},"start":47,"end":48},{"match":{"text":"-"},"start":65,"end":66},{"match":{"text":"-"},"start":72,"end":73}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            ] : null\n"},"line_number":1188,"absolute_offset":45703,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        ];\n"},"line_number":1189,"absolute_offset":45740,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    }),\n"},"line_number":1190,"absolute_offset":45767,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'hod_users' => $hodUsers->map(function($hodUser) {\n"},"line_number":1191,"absolute_offset":45791,"submatches":[{"match":{"text":"-"},"start":44,"end":45}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        $assignedDepts = Department::where('hod_user_id', $hodUser->id)->get();\n"},"line_number":1192,"absolute_offset":45862,"submatches":[{"match":{"text":"-"},"start":82,"end":83},{"match":{"text":"-"},"start":87,"end":88}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        return [\n"},"line_number":1193,"absolute_offset":45958,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'id' => $hodUser->id,\n"},"line_number":1194,"absolute_offset":45991,"submatches":[{"match":{"text":"-"},"start":44,"end":45}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'name' => $hodUser->name,\n"},"line_number":1195,"absolute_offset":46041,"submatches":[{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'email' => $hodUser->email,\n"},"line_number":1196,"absolute_offset":46095,"submatches":[{"match":{"text":"-"},"start":47,"end":48}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'role' => $hodUser->role->name,\n"},"line_number":1197,"absolute_offset":46151,"submatches":[{"match":{"text":"-"},"start":46,"end":47},{"match":{"text":"-"},"start":52,"end":53}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            'assigned_departments' => $assignedDepts->map(function($dept) {\n"},"line_number":1198,"absolute_offset":46211,"submatches":[{"match":{"text":"-"},"start":68,"end":69}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                                return [\n"},"line_number":1199,"absolute_offset":46303,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                                    'id' => $dept->id,\n"},"line_number":1200,"absolute_offset":46344,"submatches":[{"match":{"text":"-"},"start":49,"end":50}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                                    'name' => $dept->name,\n"},"line_number":1201,"absolute_offset":46399,"submatches":[{"match":{"text":"-"},"start":51,"end":52}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                                    'code' => $dept->code\n"},"line_number":1202,"absolute_offset":46458,"submatches":[{"match":{"text":"-"},"start":51,"end":52}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                                ];\n"},"line_number":1203,"absolute_offset":46516,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                            })\n"},"line_number":1204,"absolute_offset":46551,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        ];\n"},"line_number":1205,"absolute_offset":46582,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    }),\n"},"line_number":1206,"absolute_offset":46609,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'statistics' => [\n"},"line_number":1207,"absolute_offset":46633,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'total_users' => $allUsers->count(),\n"},"line_number":1208,"absolute_offset":46671,"submatches":[{"match":{"text":"-"},"start":50,"end":51}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'total_departments' => $allDepartments->count(),\n"},"line_number":1209,"absolute_offset":46732,"submatches":[{"match":{"text":"-"},"start":62,"end":63}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'hod_users_count' => $hodUsers->count(),\n"},"line_number":1210,"absolute_offset":46805,"submatches":[{"match":{"text":"-"},"start":54,"end":55}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'departments_with_hod' => $allDepartments->whereNotNull('hod_user_id')->count(),\n"},"line_number":1211,"absolute_offset":46870,"submatches":[{"match":{"text":"-"},"start":65,"end":66},{"match":{"text":"-"},"start":94,"end":95}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                        'departments_without_hod' => $allDepartments->whereNull('hod_user_id')->count()\n"},"line_number":1212,"absolute_offset":46975,"submatches":[{"match":{"text":"-"},"start":68,"end":69},{"match":{"text":"-"},"start":94,"end":95}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    ]\n"},"line_number":1213,"absolute_offset":47079,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ]\n"},"line_number":1214,"absolute_offset":47101,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":1215,"absolute_offset":47119,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":1216,"absolute_offset":47135,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":1217,"absolute_offset":47169,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":1218,"absolute_offset":47207,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Debug endpoint error: ' . $e->getMessage()\n"},"line_number":1219,"absolute_offset":47243,"submatches":[{"match":{"text":"-"},"start":58,"end":59}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":1220,"absolute_offset":47316,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        }\n"},"line_number":1221,"absolute_offset":47337,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    }\n"},"line_number":1222,"absolute_offset":47347,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    public function exportPdf(Request $request, int $id)\n"},"line_number":1227,"absolute_offset":47396,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"    {\n"},"line_number":1228,"absolute_offset":47453,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        try {\n"},"line_number":1229,"absolute_offset":47459,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $user = $request->user();\n"},"line_number":1230,"absolute_offset":47473,"submatches":[{"match":{"text":"-"},"start":28,"end":29}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $form = ModuleAccessRequest::bothServiceForm()\n"},"line_number":1231,"absolute_offset":47511,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->with(['user', 'department', 'hodUser', 'divisionalDirectorUser', 'dictUser', 'hodItUser', 'ictOfficerUser'])\n"},"line_number":1232,"absolute_offset":47570,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ->findOrFail($id);\n"},"line_number":1233,"absolute_offset":47697,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":1234,"absolute_offset":47732,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Check if user can view this form\n"},"line_number":1235,"absolute_offset":47733,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            if (!$this->canUserViewForm($user, $form)) {\n"},"line_number":1236,"absolute_offset":47781,"submatches":[{"match":{"text":"-"},"start":22,"end":23}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                return response()->json([\n"},"line_number":1237,"absolute_offset":47838,"submatches":[{"match":{"text":"-"},"start":33,"end":34}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'success' => false,\n"},"line_number":1238,"absolute_offset":47880,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                    'message' => 'Unauthorized to export this form'\n"},"line_number":1239,"absolute_offset":47920,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                ], 403);\n"},"line_number":1240,"absolute_offset":47988,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            }\n"},"line_number":1241,"absolute_offset":48013,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":1242,"absolute_offset":48027,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            // Generate PDF\n"},"line_number":1243,"absolute_offset":48028,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $pdf = PDF::loadView('pdf.both-service-form.form', compact('form'));\n"},"line_number":1244,"absolute_offset":48056,"submatches":[{"match":{"text":"-"},"start":42,"end":43},{"match":{"text":"-"},"start":50,"end":51}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $pdf->setPaper('A4', 'portrait');\n"},"line_number":1245,"absolute_offset":48137,"submatches":[{"match":{"text":"-"},"start":16,"end":17}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":1246,"absolute_offset":48183,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            $filename = \"both-service-form-{$form->pf_number}-{$form->id}.pdf\";\n"},"line_number":1247,"absolute_offset":48184,"submatches":[{"match":{"text":"-"},"start":29,"end":30},{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":42,"end":43},{"match":{"text":"-"},"start":49,"end":50},{"match":{"text":"-"},"start":61,"end":62},{"match":{"text":"-"},"start":68,"end":69}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":1248,"absolute_offset":48264,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return $pdf->download($filename);\n"},"line_number":1249,"absolute_offset":48265,"submatches":[{"match":{"text":"-"},"start":23,"end":24}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":1250,"absolute_offset":48311,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"        } catch (\\Exception $e) {\n"},"line_number":1251,"absolute_offset":48312,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            Log::error('Error exporting both-service-form PDF', [\n"},"line_number":1252,"absolute_offset":48346,"submatches":[{"match":{"text":"-"},"start":44,"end":45},{"match":{"text":"-"},"start":52,"end":53}]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'error' => $e->getMessage(),\n"},"line_number":1253,"absolute_offset":48412,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'form_id' => $id,\n"},"line_number":1254,"absolute_offset":48457,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'user_id' => $request->user()?->id\n"},"line_number":1255,"absolute_offset":48491,"submatches":[{"match":{"text":"-"},"start":37,"end":38},{"match":{"text":"-"},"start":46,"end":47}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ]);\n"},"line_number":1256,"absolute_offset":48542,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"\n"},"line_number":1257,"absolute_offset":48558,"submatches":[]}}
{"type":"match","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            return response()->json([\n"},"line_number":1258,"absolute_offset":48559,"submatches":[{"match":{"text":"-"},"start":29,"end":30}]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'success' => false,\n"},"line_number":1259,"absolute_offset":48597,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"                'message' => 'Failed to export PDF'\n"},"line_number":1260,"absolute_offset":48633,"submatches":[]}}
{"type":"context","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"lines":{"text":"            ], 500);\n"},"line_number":1261,"absolute_offset":48685,"submatches":[]}}
{"type":"end","data":{"path":{"text":"backend/app/Http/Controllers/Api/v1/BothServiceFormController.php"},"binary_offset":null,"stats":{"elapsed":{"secs":0,"nanos":1203000,"human":"0.001203s"},"searches":1,"searches_with_match":1,"bytes_searched":48723,"bytes_printed":269842,"matched_lines":396,"matches":541}}}
{"data":{"elapsed_total":{"human":"0.005758s","nanos":5757900,"secs":0},"stats":{"bytes_printed":269842,"bytes_searched":48723,"elapsed":{"human":"0.001203s","nanos":1203000,"secs":0},"matched_lines":396,"matches":541,"searches":1,"searches_with_match":1}},"type":"summary"}
